<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Differential Gene Expression Analysis  
        in Atopic Dermatitis 
        Using DESeq2
    </title>

	<!-- ===================================  favicon icon ===================================== -->
 <!--   favicon icon: This line below adds a favicon to the tab of the web browser. 
    The favicon is the small icon displayed next to the page title in the browser tab.
    The 'href' attribute specifies the path to the icon file hosted on GitHub. -->

    <link rel="icon" type="image/x-icon" href="https://mohammadrezamohajeri.github.io/Breast-Cancer-Gene-Expression-Biomarker-Analysis/Images/1.ico"> 
    	<!-- ===================================================================================== -->

	
	<!-- =================================== Code Block Styling with Prism.js ===================================== -->
    <!--  Prism.js CSS for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.5.0/prism-dracula.min.css" rel="stylesheet">
	<!-- =================================== Code Block Styling with Prism.js ===================================== -->

	
    <style>


/*  =============================================================================================================   */ 
/*  ====================== To highlight the figure or caption when a user clicks on the link:  ================   */ 
	    /*  ====================== Step 1: Add a CSS class for highlighting  ================   */ 
       
        .highlight {
	    animation: highlightAnimation 5s ease-out;
	  }
	
	  @keyframes highlightAnimation {
	    from {
	      background-color: yellow;
	    }
	    to {
	      background-color: transparent;
	    }
	  }
       
/*  =============================================================================================================   */ 



	    
	/*  =================== the text color when is selected  ==============   */ 
	    /* To change the color of text selection on a webpage (like the blue or yellow highlight  ), 
		we can use the ::selection CSS pseudo-element. */ 
		::selection {
			background-color: yellow; /* Change this to any color you prefer */
			color: black; /* Change the text color if needed */
		}
	/*  ===================================================================   */ 

	    
        /* Basic Styles */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f9f9f9;
	    text-align: justify; /* Justify text globally */
        }

        /* Header Style */
        .header {
            font-size: 25px;
            background-color: #01031f;
            color: white;
            height: 350px; /* Set an explicit height */
            padding: 10px 0;
            text-align: center;
            position: relative; /* Add relative positioning here */
        }

        /* Home Link Style */
        .home-link {
            position: absolute;
            bottom: 10px;
            left: 10px;
            text-decoration: none; /* Remove underline */
            z-index: 1; /* Ensures it appears above other content */
        }

        /* Title Style */
        .title {
            font-size: 26px;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
        }

        /* Explanation Text Style */
        .explanation {
            font-size: 24px; /* Increased explanation font size */
            margin-bottom: 20px;

        }



	    
/*  ============ To increase the space above the headings ========== */
        /* Heading Margin Adjustments to Reduce Space */
	h3, h4, h5 {
	    margin-top: 60px; /* Reduced space above */
	    margin-bottom: 5px; /* Reduced space below */
        }


        .code-caption {
	    font-size: 16px; /* Slightly smaller than body text, but still readable */
	    font-style: italic;
	    margin-bottom: 1px; /* Reduce the bottom margin */
	    color: #555;
	    text-align: justify;
	}

	 	    

        /* Code Block Style */
        .code-block {
            margin-bottom: 20px;
            font-size: 16px; /* Increased code block font size */
        }

        /* Prism.js Code Block Font Size */
        pre[class*="language-"] {
            font-size: 16px; /* Increase font size for Prism.js code blocks */
        }

	/* Adjust ul and li styles */
	ul {
	    margin-top: 0 !important;
	    margin-bottom: 0 !important;
	    padding-left: 20px !important; /* Adjust padding */
	}
	
	li {
	    margin-bottom: 5px !important; /* Adjust space between list items */
	}

		    
    </style>
</head>
<body>

    <div class="header">

        <!-- the positioning of the "Home" icon -->
        <a href="https://mohammadrezamohajeri.github.io/Main_Portfolio/index.html" class="home-link">
            <img src="Pictures/Home_Link_JPG/1.jpg" alt="Home" style="width:50px; height:auto;">
        </a>
        
        <h1>Differential Gene Expression Analysis <br>
            in Atopic Dermatitis  <br>
            Using DESeq2</h1>
    </div>
    

    
    
    <div class="body">

       		 <!-- ============== A horizontal line ================== -->
		<!-- Add a horizontal line above the introduction -->
		<hr style="border: none; border-top: 1px solid black; margin: 20px 0;">
		 <!-- =================================================== -->

        
        <!-- ================================================================== -->
        <div class="explanation">
          <h3>Introduction to Differential Gene Expression in Atopic Dermatitis (AD) Patients</h3>
          <ul>
	    <li>  
               In this analysis, we perform <strong>Differential Gene Expression (DEG) analysis</strong> using the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4878611/" target="_blank"><strong>DESeq2</strong></a> package on the <strong><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE157194" target="_blank">GSE157194</a></strong> dataset, which consists of RNA-seq data from patients with <strong>Atopic Dermatitis (AD)</strong>. This dataset includes a total of <strong>166 samples</strong> obtained from <strong>57 patients</strong> with moderate to severe AD, prior to and after systemic treatment.
            </li>
	  </ul>

		
       
	       
	   
		
          <h4>Dataset Overview:</h4>
          <ul>
            <li><strong><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE157194" target="_blank">GSE157194</a></strong>: RNA-seq data from AD patients.</li>
            <li><strong>111 samples before treatment</strong>: Includes <strong>lesional (AL)</strong> and <strong>non-lesional (AN)</strong> skin biopsies. Non-lesional samples were taken at least 5 cm from the active lesion, ensuring that the comparison between these conditions captures the underlying gene expression differences in the disease state before any intervention.</li>
            <li><strong>40 samples post-treatment with Dupilumab</strong> (3 months).</li>
            <li><strong>15 samples post-treatment with Cyclosporine</strong> (3 months).</li>
          </ul>
        
          <h4>Objective of This Analysis:</h4>
          <ul>
	    <li>
              Our primary focus is to conduct a differential expression analysis between the <strong>lesional (AL)</strong> and <strong>non-lesional (AN)</strong> skin samples <strong>before treatment</strong>. This helps in identifying key <strong>differentially expressed genes (DEGs)</strong> and associated <strong>pathways</strong> that distinguish diseased skin from non-diseased skin. Insights gained from this comparison can:
            </li>
           
            <li>Reveal potential <strong>biomarkers</strong> for AD diagnosis and monitoring.</li>
            <li>Highlight novel <strong>therapeutic targets</strong> or <strong>pathways</strong> relevant to AD pathogenesis.</li>
            <li>Provide groundwork for <strong>drug discovery</strong> and personalized medicine by identifying pathways that could respond to specific therapeutic interventions.</li>
          </ul>
        
          <h4>Comprehensive Analysis Approach:</h4>
          <ul>
		  
	  <li>    
            This analysis incorporates various bioinformatics techniques and <strong>visualization tools</strong> (e.g., <strong>PCA</strong>, <strong>volcano plots</strong>, etc.) to ensure a holistic understanding of the gene expression profiles. While some aspects of the analysis may provide standalone insights, the goal is to create a <strong>comprehensive reference</strong> for <strong>DEG analysis using DESeq2</strong>. This can serve as a <strong>functional analysis resource</strong> for future studies.
          </li>

	  </ul>  

		
          <h4>
            In addition to the DEG analysis, we also perform pathway and gene enrichment analysis, including:
          </h4>
		
          <ul>
            <li><strong>KEGG</strong> and <strong>GO term</strong> analyses.</li>
            <li><strong>Gene Set Enrichment Analysis (GSEA)</strong> and <strong>Overrepresentation Analysis (ORA)</strong> to explore the biological processes, molecular functions, and cellular components involved in AD.</li>
          </ul>
		
        </div>


       		 <!-- ============== A horizontal line ================== -->
		<!-- Add a horizontal line above the introduction -->
		<hr style="border: none; border-top: 1px solid black; margin: 20px 0;">
		 <!-- =================================================== -->
	  <!-- ================================================================== -->
	<div class="explanation">
	    <h3>1. Load Necessary Libraries</h3>
	    <p>Before starting the analysis, we need to load the essential R libraries required for <strong>data manipulation</strong>, <strong>visualization</strong>, and performing <strong>differential gene expression (DEG) analysis</strong>.</p>
	</div>
	
	<div class="code-block">
	    <pre><code class="language-r">
	# Load necessary libraries for RNA-seq analysis and visualization
	library(GEOquery)        # Load the GEOquery package to access GEO datasets
	library(DESeq2)          # For differential expression analysis
	library(data.table)      # Efficient data manipulation
	library(umap)            # Dimensionality reduction for visualization
	library(ggplot2)         # General-purpose plotting
	library(clusterProfiler) # For functional enrichment analysis
	library(org.Hs.eg.db)    # Human genome annotations
	library(VennDiagram)     # Venn diagram visualization
	library(knitr)           # Report generation and table formatting (for kable)
	library(tinytex)         # LaTeX support for report generation
	    </code></pre>
	</div>


		 <!-- ============== A horizontal line ================== -->
				<!-- Add a horizontal line above the introduction -->
				<hr style="border: none; border-top: 1px solid black; margin: 20px 0;">
		 <!-- =================================================== -->
	    
	<!-- ================================ 2. ================================== -->
	<div class="explanation">
	    <h3>2. Load and Prepare Data</h3>
		<h4 style="margin-top: 5px;">2.1. Retrieving Data from GEO</h4>

	    <ul>	
		<li>In this step, we download the <strong>raw gene expression data</strong> (count matrix) and  <strong>the sample information</strong> (referred to as <strong>metadata</strong> or <strong>phenotype data</strong>) from the <strong>Gene Expression Omnibus (GEO)</strong> using GEO's accession ID <strong>GSE157194</strong>. The count matrix contains raw gene expression counts, while the phenotype data contains metadata for each sample (such as treatment groups and sample type).</li>
	    </ul>
		
	    <ul>
	        <li>In this code (Code Block 2.1), we begin by downloading and preparing the dataset for analysis. Step 1 involves defining the GEO accession ID (gse_id <- "GSE157194") and using <strong>getGEOSuppFiles()</strong> from the <strong>GEOquery</strong> library to download the supplementary count matrix, which is then loaded into R using <strong>read.table()</strong> after decompressing the .gz file. In Step 2, the phenotype data (metadata) is obtained using <strong>getGEO()</strong> from GEOquery, and stored in metadata. The metadata provides additional descriptive information about the samples in the count matrix. Step 3 prints summary information (  <a href="#figure-2-1" onclick="highlightFigure('2-1')">Figure 2.1</a>), including the number of genes and samples in the count matrix and the number of samples and features in the metadata, after downloading the data from GEO, for a quick overview of the dataset.</li>
	    </ul>
	</div>


	<!-- Caption for the code block -->
	<p class="code-caption">Code Block 2.1. Retrieving Data from GEO</p>
	    
	<div class="code-block">
	    <pre><code class="language-r">
	# ===================================================================
	# Step 1. Download Supplementary Files for the Count Matrix
	# ===================================================================

	# Define the GEO accession ID
	gse_id <- "GSE157194"
	
	# Download the supplementary files for this GEO dataset
	getGEOSuppFiles(gse_id)
	
	# Check the list of files downloaded
	list.files(gse_id)
	
	# ================================
	# Path to the downloaded file
	supp_file_path <- paste0(gse_id, "/", "GSE157194_Raw_gene_counts_matrix.txt.gz")
	
	# Unzip and load the file into R as a data frame (counts matrix)
	counts_matrix <- read.table(gzfile(supp_file_path), header = TRUE, row.names = 1)
 
	# ===================================================================
	# Step 2. Download Phenotype Data
	# ===================================================================
	# Specify the GEO accession number
	gse_id <- "GSE157194"
	
	
	# Download the phenotype data (GEO series matrix)
	gse_data <- getGEO(gse_id, GSEMatrix = TRUE, AnnotGPL = TRUE)
	
	# If multiple series are available, choose the first one
	gse_data <- gse_data[[1]]
	
	# Extract metadata from the GEO dataset
	# We access the metadata (also known as phenotype data) stored in the 'phenoData' slot of the GEO object.
	metadata <- gse_data@phenoData@data
	
	# ===================================================================
	# Step 3. Print Summary Information about the Count Matrix and Metadata
	# ===================================================================
	cat("\n\n# Summary Information of the Count Matrix and Metadata (Post-GEO Download)\n")
	cat("=========================================================\n")
	
	# Count matrix summary
	cat("\nCount Matrix Summary:\n")
	cat("---------------------------------------------------------\n")
	cat("Number of Genes (Rows): ", nrow(counts_matrix), "\n")
	cat("Number of Samples (Columns): ", ncol(counts_matrix), "\n\n")
	
	
	# Metadata summary
	cat("\nMetadata Summary:\n")
	cat("---------------------------------------------------------\n")
	cat("Number of Samples (Rows): ", nrow(metadata), "\n")
	cat("Number of Features (Columns): ", ncol(metadata), "\n\n")
	
	cat("\n=========================================================\n")
			
	    </code></pre>
	</div>

	<!-- Figure 2.1.Summary Information of the Count Matrix and Metadata   -->
	    <figure id="figure-2-1" style="text-align: justify; margin: 10px;">
	        <a href="Pictures/RNA_Seq_Task1/Figure2.1.Summary_Information_of_the_Count_Matrix_Metadata.png" target="_blank">
	            <img src="Pictures/RNA_Seq_Task1/Figure2.1.Summary_Information_of_the_Count_Matrix_Metadata.png" alt="Heatmap 1" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 75%; height: 300px;">
	        </a>
	        <figcaption id="figure-caption-2-1">
			Figure 2.1. Summary Information of the Count Matrix and Metadata (Post-GEO Download). This figure displays the number of genes and samples in the count matrix, as well as the number of samples and features in the metadata after downloading from the GEO dataset.
		</figcaption>
	    </figure>

		
			<!-- ========================================= 2.2 ======================================== -->
			<div class="explanation">
			    <h3>2.2. Preparing Data</h3>
			    <ul>
			        <li><strong>Effective data preparation</strong> is crucial for ensuring high-quality and accurate results in downstream analyses. This step includes identifying and <u>removing potential outlier samples</u> to avoid biases and <u>pre-filtering low-count genes</u> to enhance the overall data quality.</li>
			    </ul>
			    <h4 style="margin-top: 5px;">2.2.1. Identify and Remove Outlier Samples</h4>
			    <ul> 
			        <li><u>Outlier samples</u>, particularly those with significantly <u>low or high library sizes</u>, can introduce biases into the analysis and skew the results. Therefore, it is crucial to identify and remove such samples before conducting further data manipulations to ensure that the remaining data is representative of high-quality samples, allowing for reliable downstream analyses.</li>
			        <li>Traditionally, removing <u>samples below the lower threshold</u> (calculated as Q1 - 1.5 * IQR) is a common practice, as these samples often indicate technical issues, such as failed sequencing or low quality. <u>Samples above the upper threshold</u> (Q3 + 1.5 * IQR) are typically retained, as they are often biologically meaningful (e.g., having high sequencing depth), and removing them could risk discarding valuable information. However, if it can be demonstrated that such samples introduce bias or are clearly problematic, it might be necessary to remove them to maintain data integrity.</li>
			        <li>Based on the <a href="#figure-2-2-1-1" onclick="highlightFigure('2-2-1-1')">dot plot of library sizes</a>, we identified a total of <u>six outlier samples</u> from 166 original samples: three with significantly low counts (Patient_12_AN_m3, Patient_24_AN_m3, Patient_31_AL_m0) and three with significantly high counts (Patient_41_AL_m3, Patient_42_AL_m0, Patient_48_AL_m3). Although <u>the high-count samples</u> might be biologically distinct, <u>their presence could mask potential biomarkers within the majority of the population by over-influencing the analysis</u> . Therefore, to ensure that we focus on <u>identifying biomarkers that are representative of the majority</u>, we have decided to remove both lower and upper threshold outliers.</li>
			        <li>The provided code is written to handle either scenario, allowing users to remove only the lower threshold outliers, or both lower and upper threshold outliers. Comments within the code explain which lines to uncomment or comment out based on the user's chosen approach. In this case, both thresholds are applied to remove the six outlier samples, resulting in a filtered dataset that better represents the core population.</li>
			        <li>Not all the plots presented in the code are necessary to generate; they are provided here to demonstrate different ways of visualizing the effect of removing outlier samples.</li>
			        <li>In this code (<strong>Code Block 2.2.1</strong>), we begin with <strong>Step 1</strong>, which involves <u>calculating the library sizes for each sample</u> using <strong>colSums(counts_matrix)</strong>. This operation returns the total count of all reads for each sample. The summary statistics (<strong>summary(library_sizes)</strong>) is then printed to provide an overview of the data distribution (Min= 9,628,756, 1st Qu=20,647,659, Median=22,896,256, Mean=23,218,539, 3rd Qu= 25,719,325, Max= 43,076,805). Next, in <strong>Step 1.1</strong>, we set <u>two thresholds for outlier identification</u>, using <strong>quantiles</strong> (Q) and the <strong>interquartile</strong> range (IQR). The first quartile (<strong>quantile(library_sizes, 0.25)</strong>) and the third quartile (<strong>quantile(library_sizes, 0.75)</strong>) represent the 25th and 75th percentiles of the data, respectively. The IQR (<strong>IQR(library_sizes)</strong>) indicates the spread of the central 50% of the data and helps to assess data variability. We then calculate the lower threshold as <strong>Q1 - 1.5 * IQR</strong>, which targets low outliers that may indicate poor-quality or problematic samples. Optionally, the upper threshold is calculated as <strong>Q3 + 1.5 * IQR</strong> to identify samples with unusually high counts, which may also be removed if deemed necessary. In <strong>Step 1.2</strong>, depending on the user's choice, either or both thresholds can be used to define outlier samples. These outliers are identified using logical conditions, and their indices are used to remove them from both "counts_matrix" and "metadata", resulting in the creation of filtered versions ("counts_matrix_filtered" and "metadata_filtered") (<strong>Step 3</strong>). After identifying the outliers, in <strong>Step 2</strong>, we store the original dimensions of both "counts_matrix" and "metadata" before filtering. This allows us to compare them against the dimensions after outlier removal, which we store in <strong>Step 3.3</strong>. In <strong>Step 3</strong>, we remove the outlier samples from the "counts_matrix" (<strong>Step 3.1</strong>) and "metadata" (<strong>Step 3.2</strong>), ensuring that the metadata matches the "filtered counts_matrix". After filtering, we reassign the filtered versions back to "counts_matrix" and "metadata" to ensure consistency for subsequent analysis steps (<strong>Step 6</strong>). In <strong>Step 4</strong>, following the removal of outliers, we create various visualizations (dot plot <a href="#figure-2-2-1-1" onclick="highlightFigure('2-2-1-1')">(Figure 2.2.1.1)</a>, bar plot <a href="#figure-2-2-1-2" onclick="highlightFigure('2-2-1-2')">(Figure 2.2.1.2)</a>, boxplot <a href="#figure-2-2-1-3" onclick="highlightFigure('2-2-1-3')">(Figure 2.2.1.3)</a>, density plot <a href="#figure-2-2-1-4" onclick="highlightFigure('2-2-1-4')">(Figure 2.2.1.4)</a>, and violin plot <a href="#figure-2-2-1-5" onclick="highlightFigure('2-2-1-5')">(Figure 2.2.1.5)</a>) to illustrate the changes in library sizes before and after filtering. These visualizations provide insights into the effects of outlier removal on the dataset. Specifically:</li>
			    </ul>
			    <ul>
			        <li><strong>Boxplots</strong> and <strong>Violin plots</strong> are used to compare the distributions of library sizes before and after filtering.</li>
			        <li><strong>Dot plots</strong> annotate specific outlier samples that were removed.</li>
			        <li><strong>Bar plots</strong> allow for a direct comparison of individual sample library sizes before and after filtering.</li>
			        <li><strong>Density plots</strong> provide an overview of the entire distribution of library sizes.</li>
			    </ul>
			    <ul>
			        <li>In <strong>Step 5</strong>, we generate visualizations to confirm the changes in the dimensions of the "counts_matrix" and "metadata" before and after outlier removal using dimensions comparison plot <a href="#figure-2-2-1-6" onclick="highlightFigure('2-2-1-6')">(Figure 2.2.1.6)</a> as well as Summary Information <a href="#figure-2-2-1-7" onclick="highlightFigure('2-2-1-7')">(Figure 2.2.1.7)</a>. To achieve this, we create data frames representing the count matrix dimensions and metadata dimensions, both before and after filtering (<strong>Step 5.1</strong> and <strong>Step 5.2</strong>). These data frames are then used to generate four bar plots, which illustrate the number of genes, samples, and metadata features before and after filtering. These four plots are combined into a single figure using the <Strong>grid.arrange()</Strong> function from the <Strong>gridExtra</Strong> library (<strong>Step 5.3</strong>). This combined visualization provides a clear overview of how filtering affected the dataset dimensions.</li>
			    </ul>
			</div>

			


		
			<!-- Caption for the code block -->
			<p class="code-caption">Code Block 2.2.1: Identifying and Removing Outlier Samples, and Visualizing the Impact</p>
			
			<div class="code-block">
			    <pre><code class="language-r">
	# ========================================================
	# Load necessary libraries
	# ========================================================
	library(ggplot2)
	library(gridExtra) # For arranging multiple plots in one figure
	
	# ========================================================
	# Step 1: Calculate Library Size and Identify Outliers
	# ========================================================
	
	# Calculate library sizes
	library_sizes <- colSums(counts_matrix)
	
	# Optionally, print summary to check for anomalies
	summary(library_sizes)
	
	# Identify potential outlier samples based on library size
	# Step 1.1: Set thresholds for outlier identification
	# Set the lower threshold to identify samples with low counts
	lower_threshold <- quantile(library_sizes, 0.25) - 1.5 * IQR(library_sizes)
	
	# Set the upper threshold to identify samples with very high counts
	upper_threshold <- quantile(library_sizes, 0.75) + 1.5 * IQR(library_sizes)
	
	
	# Step 1.2: Find outlier samples
	# Uncomment the corresponding line depending on whether you want to use:
	# - Only the lower threshold
	# - Only the upper threshold
	# - Both lower and upper thresholds
	
	# Use only the lower threshold:
	# outlier_samples <- colnames(counts_matrix)[library_sizes < lower_threshold]
	
	# Use both lower and upper thresholds:
	outlier_samples <- colnames(counts_matrix)[library_sizes < lower_threshold | library_sizes > upper_threshold]
	
	# ========================================================
	# Step 2: Store Original Dimensions Before Filtering (First  part for Plotting Dimensions of Count Matrix and Metadata)
	# ========================================================
	
	# Store original dimensions before filtering
	counts_matrix_before <- dim(counts_matrix)  # [number of genes, number of samples]
	metadata_before <- dim(metadata)            # [number of samples, number of features]
	
	
	# ========================================================
	# Step 3: Remove Outlier Samples from Data
	# ========================================================
	
	# Step 3.1: Remove outlier samples from counts matrix
	counts_matrix_filtered <- counts_matrix[, !(colnames(counts_matrix) %in% outlier_samples)]
	
	# Step 3.2: Remove outlier samples from metadata
	metadata_filtered <- metadata[colnames(counts_matrix_filtered), ]
	
	# Step 3.3: Store dimensions after filtering (Second part for Plotting Dimensions of Count Matrix and Metadata)
	counts_matrix_after <- dim(counts_matrix_filtered)
	metadata_after <- dim(metadata_filtered)
	
	# Step 3.4: Calculate filtered library sizes
	filtered_library_sizes <- colSums(counts_matrix_filtered)
	
	# ========================================================
	# Step 4: Plot the Filtered Library Sizes (Box, Violin, Dot, Bar, Density plots)
	# ========================================================
	# Step 4.1: Prepare Data for Plotting:
	
	# Combine original and filtered library sizes into a data frame for comparison
	comparison_df <- data.frame(
	  Sample = c(names(library_sizes), names(filtered_library_sizes)),
	  Library_Size = c(library_sizes, filtered_library_sizes),
	  Group = c(rep("Original", length(library_sizes)), rep("Filtered", length(filtered_library_sizes)))
	)
	
	
	# Step 4.2: Boxplot of Library Sizes Before and After Filtering
	box_plot <- ggplot(comparison_df, aes(x = Group, y = Library_Size, fill = Group)) +
	  geom_boxplot() +
	  theme_minimal() +
	  labs(title = "Boxplot of Library Sizes Before and After Removing Outliers",
	       x = "Group", y = "Total Counts per Sample") +
	  theme(legend.position = "none")
	
	ggsave("Figures/Figure2.2.1.3.Box_Plot_Library_Sizes.png", plot = box_plot, width = 8, height = 5, bg = "white")
	
	
	# Step 4.3: Violin Plot of Library Sizes Before and After Filtering
	violin_plot <- ggplot(comparison_df, aes(x = Group, y = Library_Size, fill = Group)) +
	  geom_violin(trim = FALSE, alpha = 0.6) +
	  theme_minimal() +
	  labs(title = "Violin Plot of Library Sizes Before and After Removing Outliers",
	       x = "Group", y = "Total Counts per Sample") +
	  theme(legend.position = "none")
	
	ggsave("Figures/Figure2.2.1.5.Violin_Plot_Library_Sizes.png", plot = violin_plot, width = 8, height = 5, bg = "white")
	
	
	
	# Step 4.4: Dot Plot with Annotation of Outliers
	dot_plot <- ggplot(comparison_df, aes(x = Sample, y = Library_Size, color = Group)) +
	  geom_point() +
	  theme_minimal() +
	  labs(title = "Dot Plot of Library Sizes with Outlier Annotation", 
	       x = "Sample", y = "Total Counts per Sample") +
	  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
	  geom_text(data = subset(comparison_df, Group == "Original" & Sample %in% outlier_samples), 
		    aes(label = Sample), vjust = -1, size = 3, color = "red", angle = 5)
	
	ggsave("Figures/Figure2.2.1.1.Dot_Plot_Library_Sizes.png", plot = dot_plot, width = 10, height = 5, bg = "white")
	
	
	
	# Step 4.5: Comparative Bar Plot Before and After Filtering
	bar_plot <- ggplot(comparison_df, aes(x = Sample, y = Library_Size, fill = Group)) +
	  geom_bar(stat = "identity", position = "dodge") +
	  theme_minimal() +
	  labs(title = "Comparative Bar Plot of Library Sizes Before and After Removing Outliers", 
	       x = "Sample", y = "Total Counts per Sample") +
	  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
	
	ggsave("Figures/Figure2.2.1.2.Bar_Plot_Library_Sizes.png", plot = bar_plot, width = 10, height = 5, bg = "white")
	
	
	
	# Step 4.6: Side-by-Side Density Plot Before and After Filtering
	density_plot <- ggplot(comparison_df, aes(x = Library_Size, fill = Group)) +
	  geom_density(alpha = 0.5) +
	  theme_minimal() +
	  labs(title = "Density Plot of Library Sizes Before and After Removing Outliers", 
	       x = "Total Counts per Sample", y = "Density") +
	  scale_x_log10() +
	  theme(legend.position = "top")
	
	ggsave("Figures/Figure2.2.1.4.Density_Plot_Library_Sizes.png", plot = density_plot, width = 8, height = 5, bg = "white")
	
	
	# ========================================================
	# Step 5: Plot Dimensions of Count Matrix and Metadata (Third  part for Plotting Dimensions of Count Matrix and Metadata)
	# ========================================================
	
	# Step 5.1: Create Data Frames for Count Matrix Dimensions
	counts_matrix_dims <- data.frame(
	  Measure = rep(c("Samples", "Genes"), each = 2),
	  Stage = rep(c("Before Filtering", "After Filtering"), 2),
	  Count = c(counts_matrix_before[2], counts_matrix_after[2],
		    counts_matrix_before[1], counts_matrix_after[1])
	)
	
	# Step 5.2: Create Data Frames for Count Matrix and Metadata Dimensions
	metadata_dims <- data.frame(
	  Measure = rep(c("Samples", "Features"), each = 2),
	  Stage = rep(c("Before Filtering", "After Filtering"), 2),
	  Count = c(metadata_before[1], metadata_after[1],
		    metadata_before[2], metadata_after[2])
	)
	
	
	# Step 5.3: Generate and Combine Plots for Dimensions
	
	# Plot for count matrix samples before and after filtering
	count_samples_plot <- ggplot(subset(counts_matrix_dims, Measure == "Samples"), aes(x = Stage, y = Count, fill = Stage)) +
	  geom_bar(stat = "identity") +
	  geom_text(aes(label = Count), vjust = -0.5) +  # Add count labels on top of bars
	  theme_minimal() +
	  labs(title = "Count Matrix: Number of Samples (Columns)", y = "Samples", x = "") +
	  theme(legend.position = "none") +
	  scale_fill_manual(values = c("Before Filtering" = "#4682B4", "After Filtering" = "#8A2BE2")) # Change colors
	
	# Plot for count matrix genes (transcripts) before and after filtering
	count_genes_plot <- ggplot(subset(counts_matrix_dims, Measure == "Genes"), aes(x = Stage, y = Count, fill = Stage)) +
	  geom_bar(stat = "identity") +
	  geom_text(aes(label = Count), vjust = -0.5) +  # Add count labels on top of bars
	  theme_minimal() +
	  labs(title = "Count Matrix: Number of Genes (Rows)", y = "Genes (Transcripts)", x = "") +
	  theme(legend.position = "none") +
	  scale_fill_manual(values = c("Before Filtering" = "#4682B4", "After Filtering" = "#8A2BE2")) # Change colors
	
	# Plot for metadata samples before and after filtering
	metadata_samples_plot <- ggplot(subset(metadata_dims, Measure == "Samples"), aes(x = Stage, y = Count, fill = Stage)) +
	  geom_bar(stat = "identity") +
	  geom_text(aes(label = Count), vjust = -0.5) +  # Add count labels on top of bars
	  theme_minimal() +
	  labs(title = "Metadata: Number of Samples (Rows)", y = "Count", x = "") +
	  theme(legend.position = "none") +
	  scale_fill_manual(values = c("Before Filtering" = "#32CD32", "After Filtering" = "#FFD700")) # Change colors
	
	# Plot for metadata features before and after filtering
	metadata_features_plot <- ggplot(subset(metadata_dims, Measure == "Features"), aes(x = Stage, y = Count, fill = Stage)) +
	  geom_bar(stat = "identity") +
	  geom_text(aes(label = Count), vjust = -0.5) +  # Add count labels on top of bars
	  theme_minimal() +
	  labs(title = "Metadata: Number of Features (Columns)", y = "Sample Attributes", x = "") +
	  theme(legend.position = "none") + 
	  scale_fill_manual(values = c("Before Filtering" =  "#32CD32", "After Filtering" = "#FFD700")) # Change colors
	
	# Arrange the four plots in a grid
	combined_plot <- grid.arrange(count_samples_plot, count_genes_plot,
				      metadata_samples_plot, metadata_features_plot,
				      ncol = 2)
	
	# Save the combined plot
	ggsave("Figures/Figure2.2.1.6.Dimensions_Comparison.png", plot = combined_plot, width = 12, height = 10, bg = "white")
	
	
	
	# ========================================================
	# Step 6: Reassign Filtered Data
	# ========================================================
	# Reassign filtered versions back to counts_matrix and metadata
	counts_matrix <- counts_matrix_filtered
	metadata <- metadata_filtered
	
	# ======================================
	# Step 7. Print Summary Information about the Count Matrix and Metadata
	# ======================================
	cat("\n\n# Summary Information of the Count Matrix and Metadata (Post-Outlier Removal)\n")
	cat("=========================================================\n")
	
	# Count matrix summary
	cat("\nCount Matrix Summary:\n")
	cat("---------------------------------------------------------\n")
	cat("Number of Genes (Rows): ", nrow(counts_matrix), "\n")
	cat("Number of Samples (Columns): ", ncol(counts_matrix), "\n\n")
	
	
	# Metadata summary
	cat("\nMetadata Summary:\n")
	cat("---------------------------------------------------------\n")
	cat("Number of Samples (Rows): ", nrow(metadata), "\n")
	cat("Number of Features (Columns): ", ncol(metadata), "\n\n")
		
			cat("\n=========================================================\n")
			    </code></pre>
			</div>
			

		

		



 

			 <!-- Figures Row with Click-to-Enlarge Feature -->
			<div style="display: flex; justify-content: space-around;">
			    
			    <!-- Dot Plot (Figure 2.2.1.1) -->
			    <figure id="figure-2-2-1-1" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.1.1.Dot_Plot_Library_Sizes.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.1.1.Dot_Plot_Library_Sizes.png" alt="Dot Plot of Library Sizes with Outlier Annotation" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px; object-fit: contain;">
			
			        </a>
			        <figcaption id="figure-caption-2-2-1-1">
			            <strong>Figure 2.2.1.1.</strong> Dot Plot of Library Sizes with Outlier Annotation. This dot plot visualizes the library sizes for all samples before and after outlier removal. The outlier samples are clearly labeled to show their positions, with the filtered samples marked in red and labeled. It illustrates the rationale behind removing outliers by highlighting samples that significantly deviate from the main distribution.
			        </figcaption>
			    </figure>
			
			    <!-- Bar Plot (Figure 2.2.1.2) -->
			    <figure id="figure-2-2-1-2" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.1.2.Bar_Plot_Library_Sizes.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.1.2.Bar_Plot_Library_Sizes.png" alt="Comparative Bar Plot of Library Sizes" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px; object-fit: contain;">
			        </a>
			        <figcaption id="figure-caption-2-2-1-2">
			            <strong>Figure 2.2.1.2.</strong> Comparative Bar Plot of Library Sizes Before and After Removing Outliers. This bar plot compares the total counts per sample before and after removing the identified outliers. It allows a direct comparison of individual library sizes, illustrating how outlier removal affects the data distribution.
			        </figcaption>
			    </figure>
			
			    <!-- Box Plot (Figure 2.2.1.3) -->
			    <figure id="figure-2-2-1-3" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.1.3.Box_Plot_Library_Sizes.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.1.3.Box_Plot_Library_Sizes.png" alt="Boxplot of Library Sizes" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px; object-fit: contain;">
			        </a>
			        <figcaption id="figure-caption-2-2-1-3">
			            <strong>Figure 2.2.1.3.</strong> Boxplot of Library Sizes Before and After Removing Outliers. This boxplot provides a summary of the library size distributions for the original and filtered datasets. By comparing the interquartile ranges and identifying extreme values, it highlights how removing outliers impacts the spread of the data.
			        </figcaption>
			    </figure>
			
			    <!-- Density Plot (Figure 2.2.1.4) -->
			    <figure id="figure-2-2-1-4" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.1.4.Density_Plot_Library_Sizes.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.1.4.Density_Plot_Library_Sizes.png" alt="Density Plot of Library Sizes" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px; object-fit: contain;">
			        </a>
			        <figcaption id="figure-caption-2-2-1-4">
			            <strong>Figure 2.2.1.4.</strong> Density Plot of Library Sizes Before and After Removing Outliers. The density plot shows the distribution of library sizes across all samples before and after outlier removal. The plot visualizes changes in the overall density, allowing us to observe shifts in data distribution and the effects of filtering extreme values.
			        </figcaption>
			    </figure>
			
			</div>
			
			<div style="display: flex; justify-content: space-around;">
			
			    <!-- Violin Plot (Figure 2.2.1.5) -->
			    <figure id="figure-2-2-1-5" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.1.5.Violin_Plot_Library_Sizes.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.1.5.Violin_Plot_Library_Sizes.png" alt="Violin Plot of Library Sizes" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px; object-fit: contain;">
			        </a>
			        <figcaption id="figure-caption-2-2-1-5">
			            <strong>Figure 2.2.1.5.</strong> Violin Plot of Library Sizes Before and After Removing Outliers. This violin plot combines elements of a boxplot and a density plot to illustrate both the distribution and summary statistics of the library sizes before and after removing outliers. It helps visualize the spread and density of values, showing the differences between the original and filtered groups.
			        </figcaption>
			    </figure>
			
			    <!-- Dimensions Comparison (Figure 2.2.1.6) -->
			    <figure id="figure-2-2-1-6" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.1.6.Dimensions_Comparison.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.1.6.Dimensions_Comparison.png" alt="Dimensions Comparison of Count Matrix and Metadata" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px; object-fit: contain;">
			        </a>
			        <figcaption id="figure-caption-2-2-1-6">
			            <strong>Figure 2.2.1.6.</strong> Dimensions Comparison: Four bar plots showing changes in the count matrix and metadata dimensions before and after outlier removal. Only the number of samples changed, confirming that outliers were removed, while genes and features remained unchanged.
			        </figcaption>
			    </figure>
			
			
			    <!-- Summary Information (Figure 2.2.1.7) -->
			    <figure id="figure-2-2-1-7" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.1.7.Summary_Information_of_the_Count_Matrix_Metadata_After_Removing_Outlier_Samples.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.1.7.Summary_Information_of_the_Count_Matrix_Metadata_After_Removing_Outlier_Samples.png" alt="Summary Information of the Count Matrix and Metadata" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px; object-fit: contain;">
			        </a>
			        <figcaption id="figure-caption-2-2-1-7">
			            <strong>Figure 2.2.1.7.</strong> Summary Information of the Count Matrix and Metadata (Post-Outlier Removal), showing the updated number of genes, samples, and features after removing outlier samples.
			        </figcaption>
			    </figure>
			
			</div>


			<!-- ========================================= 2.2.2 ======================================== -->
			<div class="explanation">
			    <h3>2.2.2. Pre-filtering Low-Count Genes to Improve Data Quality</h3>
			    <ul>
			        <li><strong>Low-count genes</strong>, which are expressed at insufficient levels, can contribute noise and increase the likelihood of false-positive results. Removing these lowly-expressed genes ensures that the analysis focuses on biologically meaningful signals and helps to reduce computational complexity and improve the robustness of downstream analyses.</li>
			        
			        <li>In this code (<strong>Code Block 2.2.2</strong>), we first (<strong>Step 1</strong>) create a logical matrix to identify genes with sufficient expression (counts ≥ 10). Specifically, we retain only those genes that have counts of at least 10 in at least half of the samples (<code>ncol(counts_matrix) / 2</code>). This step ensures that the filtered dataset retains genes with meaningful levels of expression across a significant number of samples. After identifying the genes to keep, we filter the <code>counts_matrix</code> to retain only those genes, reassign the filtered matrix back to <code>counts_matrix</code> (<strong>Step 2</strong>), and then check the dimensions of the filtered dataset (<strong>Step 3</strong>) to confirm the number of genes and samples that remain (<a href="#figure-2-2-2" onclick="highlightFigure('2-2-2')">Figure 2.2.2</a>).</li>
			    </ul>
			</div>
			
			<!-- Caption for the code block -->
			<p class="code-caption"><strong>Code Block 2.2.2:</strong> Pre-filtering Low-Count Genes to Improve Data Quality</p>
			
			<!-- Code Block 2.2.2: Pre-filtering Low-Count Genes to Improve Data Quality -->
			<div class="code-block">
			    <pre><code class="language-r">
			# ========================================================
			# Step 1: Pre-filter low-count genes
			# ========================================================
			
			# Step 1: Create a logical matrix to check if each value in counts_matrix is >= 10 (sufficient expression).
			# Step 2: Retain genes that have counts >= 10 in at least half of the samples (ncol(counts_matrix) / 2). 
			keep_genes <- rowSums(counts_matrix >= 10) >= (ncol(counts_matrix) / 2)
			
			# Filter the counts matrix to retain only the genes that meet the filtering criteria
			filtered_counts_matrix <- counts_matrix[keep_genes, ]
			
			# ========================================================
			# Step 2: Reassign filtered matrix to counts_matrix
			# ========================================================
			
			# Assign the filtered counts matrix back to counts_matrix for consistency in later steps
			counts_matrix <- filtered_counts_matrix
			
			# ======================================
			# Step 3. Check dimensions of the filtered matrix (Summary Information after Low-Count Filtering)
			# ======================================
			cat("\n\n# Summary Information of the Count Matrix and Metadata (Post-Low-Count Filtering)\n")
			cat("=========================================================\n")
			
			# Count matrix summary
			cat("\nCount Matrix Summary:\n")
			cat("---------------------------------------------------------\n")
			cat("Number of Genes (Rows): ", nrow(counts_matrix), "\n")
			cat("Number of Samples (Columns): ", ncol(counts_matrix), "\n\n")
			
			# Metadata summary
			cat("\nMetadata Summary:\n")
			cat("---------------------------------------------------------\n")
			cat("Number of Samples (Rows): ", nrow(metadata), "\n")
			cat("Number of Features (Columns): ", ncol(metadata), "\n\n")
			
			cat("\n=========================================================\n")
			    </code></pre>
			</div>
			
			<!-- Summary Information of the Count Matrix and Metadata (Figure 2.2.2) -->
			<div style="display: flex; justify-content: space-around;">
			    <figure id="figure-2-2-2" style="text-align: justify; margin: 10px;">
			        <a href="Pictures/RNA_Seq_Task1/Figure2.2.2.Summary_Information_of_the_Count_Matrix_Metadata_After_Removing_Low_Count_Genes.png" target="_blank">
			            <img src="Pictures/RNA_Seq_Task1/Figure2.2.2.Summary_Information_of_the_Count_Matrix_Metadata_After_Removing_Low_Count_Genes.png" alt="Summary Information After Removing Low-Count Genes" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 75%; height: 300px;">
			        </a>
			        <figcaption id="figure-caption-2-2-2">
			            <strong>Figure 2.2.2.</strong>Summary Information of the Count Matrix and Metadata (Post-Low-Count Filtering), showing the number of genes, samples, and features after removing low-count genes.
			        </figcaption>
			    </figure>
			</div>





		
 

 		<!-- ============== A horizontal line ================== -->
				<!-- Add a horizontal line above the introduction -->
				<hr style="border: none; border-top: 1px solid black; margin: 20px 0;">
		 <!-- =================================================== -->
		 
			
<!-- ========================================= 3. ======================================== -->
		<div class="explanation">
		    <h3>3. Exploratory Data Analysis (EDA)- Before the "<a href="https://www.bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#the-deseqdataset" target="_blank"><strong>DESeqDataSet</strong></a>" object (dds) Creation</h3>
		    <ul>
	   	      <li>
			<strong>EDA</strong> is essential before performing <strong>DEA</strong> (Differential Expression Analysis) to explore the relationship between samples and to gain insights into the <strong>structure</strong> and <strong>distribution</strong> of the data. This step involves exploring both the <strong>metadata</strong> and the <strong>count matrix</strong> to ensure that the dataset is well-prepared for downstream analysis.		     
		      </li>
		    </ul> 
		</div>
<!-- =================== 3.1. explanation =========================== -->
		<div class="explanation">
		    <h3>3.1. Metadata Exploration</h3>
			<h4 style="margin-top: 5px;">3.1.1. Metadata Overview</h4>
		    <ul>
	   	      <li>
		       We examine the metadata to identify key columns for analysis, such as sample ID, experimental conditions, tissue type, time points, and treatments. Selected columns are then viewed using <strong>View() function</strong> for a quick overview of the samples (Code Block 3.1.1.; <a href="#figure-3-1-1" onclick="highlightFigure('3-1-1')">Figure 3.1.1</a>).
		      </li>
		     </ul> 
		</div>

		
		<!-- Caption for the code block -->
		<p class="code-caption">Code Block 3.1.1.  Metadata Exploration</p>
		
		<!-- ======= 3.1. code chunk =========== -->

		<div class="code-block">
		    <pre><code class="language-r">
			
		# View all column names in the metadata to select relevant columns for analysis
		# This step helps us to explore the structure of the metadata and understand which columns are available.		
		colnames(metadata)
		
		# Select relevant columns for analysis based on the experiment
		selected_metadata <- metadata[, c("geo_accession", "title", "source_name_ch1", "characteristics_ch1.2", "characteristics_ch1.3", "timepoint:ch1", "therapy:ch1", "patient id:ch1", "platform_id", "data_processing")]
		
		# Open the selected metadata in a viewer for further exploration
		View(selected_metadata)
		    </code></pre>
		</div>

		
                 <!-- ======== 3.1. image ========================================================== -->
		<figure id="figure-3-1-1" style="text-align: justify;">
		    <!-- Add a clickable link to enlarge the image -->
		    <a href="Pictures/RNA_Seq_Task1/Selected_Metadata_GSE157194.png" target="_blank">
		        <img src="Pictures/RNA_Seq_Task1/Selected_Metadata_GSE157194.png" alt="Cumulative Variance Plot" style="display: block; background-color: #f0f0f0; padding: 20px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 90%; height: 400px;">
		    </a>
		    <figcaption id="figure-caption-3-1-1">
		        Figure 3.1.1. Metadata Exploration as Part of Exploratory Data Analysis (EDA) (After filtering outlier samples).
		    </figcaption>
		</figure>
		 <!-- =============================================================================== --> 



		
	<!-- ===================  Check Distribution of Samples Across Key Metadata Variables =========================== -->
	<div class="explanation">
	    <h3>3.1.2. Check Distribution of Samples Across Key Metadata Variables (using table() and kable())</h3>
		<h4 style="margin-top: 5px;">3.1.2.1. Summary of Sample Distribution by Patient Group and Timepoints</h4>
	    <ul>
	        <li>
	            By exploring key <strong>metadata variables</strong> such as <strong>sample type</strong> (e.g., <strong>lesional</strong> vs <strong>non-lesional</strong> or <strong>treated</strong> vs <strong>untreated</strong>), <strong>timepoints</strong> (e.g., <strong>baseline</strong> vs <strong>post-treatment</strong>), and <strong>therapy groups</strong> (e.g., <strong>Cyclosporine</strong> and <strong>Dupilumab</strong>), we gain insights into <strong>the distribution of the samples</strong>  across different conditions. This exploration also helps to ensure that the dataset is well-balanced and appropriately structured for the upcoming <strong>differential expression analysis</strong>. 
	        </li>
		    
	        <li>
		    For example, after filtering out sample outliers, the <strong>source_name_ch1</strong> column in metadata shows the distribution of samples across various experimental conditions (Code Block 3.1.2; <a href="#figure-3-1-2" onclick="highlightFigure('3-1-2')">Figure 3.1.2.1</a> a), such as <strong>baseline samples</strong> (m0) for both lesional (AL) (<strong>m0_AL</strong>: 55 samples) and non-lesional (AN) (<strong>m0_AN</strong>: 54 samples) skin, which are key to our current analysis, as well as samples taken post-treatment with <strong>Cyclosporine</strong> (8 lesional & 6 non-lesional) and <strong>Dupilumab</strong> (19 lesional & 18 non-lesional samples). This data can be useful for exploring treatment effects in future experiments.
	        </li>

		    		    
	        <li>
		    In addition, <strong>characteristics_ch1.2</strong> (Code Block 3.1.2.1; <a href="#figure-3-1-2" onclick="highlightFigure('3-1-2')">Figure 3.1.2.1</a> b) provides information on the <strong>timepoints</strong> (e.g., <strong>baseline</strong> or <strong>post-treatment</strong>). This is crucial for analyzing how gene expression changes over time, particularly in response to therapies like <strong>Cyclosporine</strong> and <strong>Dupilumab</strong>. In this dataset, 51 samples were collected 3 months post-treatment, and 109 samples were collected at baseline.
	        </li>
		    
		    

	    </ul>
	</div>


		<!-- Caption for the code block -->
<p class="code-caption">Code Block 3.1.2.1: Sample Distribution Table Generation</p>
	<!-- ======= 3.3. code chunk =========== -->
	<div class="code-block">
	    <pre><code class="language-r">
# Table of samples by patient group (e.g., lesional vs non-lesional)
group_table <- table(metadata$source_name_ch1)
kable(group_table, format = "html", col.names = c("Patient Group", "Count"))

# Table of samples by timepoints (e.g., baseline vs post-treatment)
timepoint_table <- table(metadata$characteristics_ch1.2)
kable(timepoint_table, format = "html", col.names = c("Timepoint", "Count"))
	    </code></pre>
	</div>


			    <!-- ======= 3.3. image with caption =========== -->	
	<!-- ================================================================================= -->
	<div style="display: flex; justify-content: space-around; align-items: stretch;">
	    <!-- Figure 3.1.2.1. -->
	    <figure id="figure-3-1-2" style="text-align: justify; margin: 10px; flex: 1;">
	        <a href="Pictures/RNA_Seq_Task1/Samples_distribution_GSE157194.png" target="_blank">
	            <img src="Pictures/RNA_Seq_Task1/Samples_distribution_GSE157194.png" alt="Heatmap 1" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
	        </a>
	        <figcaption id="figure-caption-3-1-2">
	            <strong>Figure 3.1.2.1.</strong> Sample distribution by patient group and timepoint (After filtering outlier samples): a. Patient groups (lesional, non-lesional, post-treatment), b. Timepoint distribution (baseline and 3 months post-treatment).
	        </figcaption>
	    </figure>
	
	    <!-- Figure 3.1.2.2 -->
	    <figure id="figure-3-1-2-2" style="text-align: justify; margin: 10px; flex: 1;">
	        <a href="Pictures/RNA_Seq_Task1/Samples_Distribution2_GSE157194.png" target="_blank">
	            <img src="Pictures/RNA_Seq_Task1/Samples_Distribution2_GSE157194.png" alt="Heatmap 2" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
	        </a>
	        <figcaption id="figure-caption-3-1-2-2">
	            <strong>Figure 3.1.2.2.</strong> Sample Distribution by Timepoint and Patient ID (After Filtering Outlier Samples).
	        </figcaption>
	    </figure>
	</div>
			
<!-- ================================================================================= -->



		<div class="explanation">
	<h4 style="margin-top: 5px;">3.1.2.2. Summary of Sample Distribution Across Multiple Metadata Variables</h4>
			
  <ul>
    
    <li>
    Other metadata columns can also be explored (Code Block 3.1.2.2):      
    </li>
    
    <li>
      The <strong>characteristics_ch1.3</strong>  column (<a href="#figure-3-1-2-2" onclick="highlightFigure('3-1-2-2')">Figure 3.1.2.2</a> a) provides information about the treatment each patient received. It shows that 14 samples were treated with Cyclosporine and 37 samples with Dupilumab, while the remaining 109 samples represent baseline conditions (m0_AL and m0_AN combined). This is important for distinguishing between treatment groups when analyzing differential expression across conditions.
    </li>

	  
    <li>
      The <strong>patient id:ch1</strong> column (<a href="#figure-3-1-2-2" onclick="highlightFigure('3-1-2-2')">Figure 3.1.2.2</a> b) helps track individual patients across different conditions. Some patients may have samples from multiple conditions (e.g., lesional, non-lesional, and post-treatment with both Cyclosporine and Dupilumab), allowing for longitudinal analyses within the same individuals. For researchers, this provides an opportunity to focus on patients who have undergone multiple treatments, reducing variability and enhancing the accuracy of comparative analyses.
    </li>
    <li>
      In addition to these, other metadata columns can provide insights into the experimental setup and data processing. For example, <strong>platform_id</strong> shows all utilized platforms (GPL21290 in this experiment), <strong>extract_protocol_ch1</strong> and <strong>extract_protocol_ch1.1</strong> describe how the RNA was extracted and processed in the lab, and how the RNA libraries were prepared for sequencing. Furthermore, <strong>data_processing</strong> and its related fields provide detailed information on how the sequencing data was processed, from basecalling using Illumina software to trimming primers with cutadapt and mapping reads to the human reference genome with Tophat2 and Bowtie2. The use of Samtools to clean and sort the reads, and HTSeq to count reads per gene, ensures the data is accurately prepared for downstream analysis. The genome build used for mapping is GRCh38, and the raw count data is stored in a tab-delimited format.
    </li>
  </ul>
</div>

 

<!-- Caption for the code block 3.1.2.2. -->
<p class="code-caption">Code Block 3.1.2.2. Assessing Sample Characteristics for Experimental Design</p>
		
<!-- =============== 3.1.2.2. Code Chunk ================  -->
<div class="code-block">
  <pre><code class="language-r">

# ======================
# List of all relevant columns
# These columns are selected based on the characteristics of the experiment, 
# including metadata features like source names, patient IDs, and data processing details.
columns <- c("source_name_ch1",              # Source of the sample
             "characteristics_ch1.2",        # Experimental characteristic 1
             "characteristics_ch1.3",        # Experimental characteristic 2
             "therapy:ch1",                  # Therapy information
             "patient id:ch1",               # Patient ID
             "platform_id",                  # Platform used for data generation
             "extract_protocol_ch1",         # Sample extraction protocol 1
             "extract_protocol_ch1.1",       # Sample extraction protocol 2
             "data_processing",              # Data processing detail 1
             "data_processing.1",            # Data processing detail 2
             "data_processing.2",            # Data processing detail 3
             "data_processing.3",            # Data processing detail 4
             "data_processing.4",            # Data processing detail 5
             "data_processing.5",            # Data processing detail 6
             "data_processing.6"             # Data processing detail 7
)

# ==========
# Loop through each column and generate a summary table for each
# The loop checks if each column exists in the 'metadata' dataframe and prints a table of its unique values and frequencies.
for (col in columns) {
  if (col %in% colnames(metadata)) {  # Ensure the column exists in the metadata dataframe
    group_table <- table(metadata[[col]])  # Access and count the occurrences of each unique value in the column
    print(kable(group_table))              # Display the table using kable for a nicely formatted output
  } else {
    print(paste("Column", col, "does not exist in the metadata"))  # Handle cases where the column doesn't exist
  }
}

  </code></pre>
</div>




<!-- ========================================================== -->
	<div class="explanation">
	    <h4>3.1.3. Check Distribution of Samples Across Key Metadata Variables (using bar charts)</h4>
	    <ul>
	        <li>
	            Visualizing the distribution of samples with <strong>bar charts</strong> provides a more intuitive and visual approach compared to table-based summaries. It helps to quickly identify <u>patterns</u>, <u>imbalances</u>, or <u>trends</u> in the data, making it easier to understand the distribution across different experimental conditions or metadata variables.
	        </li>
	    </ul>
	
	    <h4>3.1.3.1. Visualizing Sample Distribution for a Single Metadata Variable Using Bar Charts</h4>
	    <ul>
	        <li>
	            This code (Code Block 3.1.3.1) focuses on visualizing a single variable, <code>source_name_ch1</code>, to display the sample distribution by experimental condition. However, the variable can be easily substituted with others if needed. <strong>(Step 1)</strong>: The <code><a href="https://ggplot2.tidyverse.org/" target="_blank">ggplot2</a></code> library is loaded for creating the plot. <strong>(Step 2)</strong>: A bar plot is constructed using <code>geom_bar()</code> to create the bars and <code>geom_text()</code> to add count labels, where <code>..count..</code> refers to the computed count statistic. The plot is styled using <code>theme_minimal()</code> and color is applied with <code>scale_fill_brewer()</code>. <strong>(Step 3)</strong>: Finally, the <code>ggsave()</code> function saves the plot to a specified location.
	        </li>
	    </ul>
	</div>
	
	<!-- Caption for the code block -->
	<p class="code-caption">Code Block 3.1.3.1. Visualizing Sample Distribution by Experimental Condition</p>
	
	<div class="code-block">
	    <pre><code class="language-r">
# ====================================
# Step 1: Load the necessary library
# ====================================
library(ggplot2)

# ============================================
# Step 2: Create a bar plot for sample counts
# ============================================
p <- ggplot(metadata, aes(x = `source_name_ch1`, fill = `source_name_ch1`)) +
  geom_bar() +  # Add bars representing sample counts
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 3) +  # Add count labels above bars
  theme_minimal() +  # Apply a minimal theme for better readability
  labs(title = "Sample Distribution by Experimental Condition", 
       x = "Source Name", 
       y = "Number of Samples") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 0.6, size = 8)) +  # Adjust axis label size and angle
  scale_fill_brewer(palette = "Set3")  # Apply a color palette for the bars

# ==================================
# Step 3: Save the plot to a file
# ==================================
ggsave("C:/Users/omidm/OneDrive/Desktop/RNA_Seq_Task1/3/3_Sample_Distributions/3.1.3.1/3.1.3.1.Sample_Distribution_by_Condition.png", 
       plot = p, width = 10, height = 6, dpi = 300, bg = "white")
    </code></pre>
</div>

<div class="explanation">
    <h4>3.1.3.2. Automated Bar Chart Generation for Multiple Metadata Variables</h4>
    <ul>
        <li>
            This approach extends the visualization to multiple metadata variables, allowing for the exploration of different aspects of the dataset. It automates the creation of bar charts, making it easy to visualize sample distributions across various metadata fields. <strong>(Step 1)</strong>: The <code><a href="https://ggplot2.tidyverse.org/" target="_blank">ggplot2</a></code> library is loaded for plotting. <strong>(Step 2)</strong>: A list of columns to visualize is defined. <strong>(Step 3)</strong>: The code loops through each column, converting column names into symbols using <code>sym()</code> and sanitizing the names with <code>gsub()</code> for valid file naming. <strong>(Step 4)</strong>: The plots are created using <code>ggplot()</code>, styled with <code>theme_minimal()</code>, and colored using <code>scale_fill_brewer()</code>. Each plot is displayed and saved to a file using <code>ggsave()</code>.
        </li>
    </ul>
</div>

<!-- Caption for the code block -->
<p class="code-caption">Code Block 3.1.3.2. Visualizing Sample Distribution for Multiple Metadata Variables Using Automated Bar Charts</p>

<div class="code-block">
    <pre><code class="language-r">
# ====================================
# Step 1: Load the necessary library
# ====================================
library(ggplot2)

# ============================================
# Step 2: Define columns to visualize
# ============================================
columns_to_plot <- c("source_name_ch1", "characteristics_ch1.2", 
                     "characteristics_ch1.3", "characteristics_ch1.4", "therapy:ch1", "timepoint:ch1")

# ========================================================
# Step 3: Loop through each column and create a bar plot
# ========================================================
for (col in columns_to_plot) {
  # Convert the column name to a symbol for tidy evaluation
  col_sym <- sym(col)
  
  # Create a sanitized version of the column name for the file name
  sanitized_col <- gsub("[:]", "_", col)  # Replace ":" with "_"
  
  # Create the plot for each column
  p <- ggplot(metadata, aes(x = !!col_sym, fill = !!col_sym)) +
    geom_bar() +  # Add bars representing sample counts
    geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 3) +  # Add count labels above bars
    theme_minimal() +  # Apply a minimal theme
    labs(title = paste("Sample Distribution by", col), x = col, y = "Number of Samples") +
    theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 0.6, size = 8)) +  # Adjust axis label size and angle
    scale_fill_brewer(palette = "Set3")  # Apply a color palette
  
  # Display the plot
  print(p)
  
  # ========================================
  # Step 4: Save the plot to a file
  # ========================================
  ggsave(filename = paste0("C:/Users/omidm/OneDrive/Desktop/RNA_Seq_Task1/3/3_Sample_Distributions/3.1.3.2/3.1.3.2_", sanitized_col, "_Sample_Distribution.png"),
         plot = p, width = 10, height = 6, dpi = 300, bg = "white")
}
    </code></pre>
</div>





		
<!-- =================== 3.2.  explanation =========================== -->
	<div class="explanation">
	    <h3> 3.2. Count Matrix: Exploration and Visualization </h3>
		<h4 style="margin-top: 5px;">3.2.1. Count Matrix Overview (Inspecting the Count Matrix using View())</h4>

	    <ul>
	        <li>
	         We examine the <strong>count matrix</strong>, which contains raw gene expression counts for each sample. This step helps us understand the structure of the data, including whether it is normalized or not, and allows us to check the <strong>column names</strong> (samples) and <strong>row names</strong> (<strong><a href="https://www.ebi.ac.uk/training/online/courses/ensembl-browsing-genomes/navigating-ensembl/investigating-a-gene/#:~:text=Ensembl%20gene%20IDs%20begin%20with,of%20species%20other%20than%20human." target="_blank">Ensembl Gene Identifiers</a></strong>) to ensure the data is formatted correctly for the next steps of differential expression analysis (Code Block 3.2.1; <a href="#figure-3-2-1" onclick="highlightFigure('3-2-1')">Figure 3.2.1</a>).
	        </li>
		    
	    </ul>
	</div>



<!-- ========== 3.2.1. Caption for the code block ============== -->
<p class="code-caption">Code Block 3.2.1. Viewing the count matrix to inspect the gene expression data for each sample.</p>
		
<!-- ======= 3.2.1. code chunk =========== -->
        <div class="code-block">
	    <pre><code class="language-r">
	# View the first few rows of the count matrix
	# This allows us to inspect the raw gene expression data for each sample.
	View(counts_matrix)
	    </code></pre>
	</div>

<!-- ============================== 3.2. Image ====================== -->
	 <figure id="figure-3-2-1" style="text-align: justify;">
	    <!-- Add a clickable link to enlarge the image -->
	    <a href="Pictures/RNA_Seq_Task1/Counts_Matrix_GSE157194.png" target="_blank">
	        <img src="Pictures/RNA_Seq_Task1/Counts_Matrix_GSE157194.png" alt="Cumulative Variance Plot" style="display: block; background-color: #f0f0f0; padding: 20px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 90%; height: 400px;">
	    </a>
	    <figcaption id="figure-caption-3-2-1">
	        Figure 3.2.1. Preview of Raw Gene Expression Count Matrix for more Inspection (After filtering out sample outliers, & Low-Count Genes).
	    </figcaption>
	</figure>

<!-- =========================  start of 3.2.2. ======================================= --> 
<!-- ================================================================================== --> 
	<div class="explanation">
	     <h3 style="margin-bottom: 0;">3.2.2. Boxplot of Raw Counts</h3>
	    <ul>
	        <li>
	            In <strong>RNA-seq analysis</strong>, <strong>boxplots of raw counts</strong> provide a crucial view of the 
	            <strong>distribution of gene expression across samples</strong>. By <strong>plotting the log-transformed counts</strong>, 
	            we can <strong>detect outliers</strong>, assess <strong>sequencing depth variations</strong>, and verify whether the data 
	            is ready for <strong>downstream analysis</strong>. <strong>Boxplots</strong> help identify potential issues, such as 
	            <strong>batch effects</strong> or <strong>technical biases</strong>, that may affect the accuracy of 
	            <strong>differential expression analysis (DEA)</strong> and the identification of <strong>biomarkers</strong>.
	        </li>
	    </ul>
	
	    <h4 style="margin-bottom: 0;">3.2.2.1. Boxplot of Raw Counts (Uncolored)</h4>
	    <ul>
	        <li>
	            This simple boxplot <a href="#figure-3-2-2-1" onclick="highlightFigure('3-2-2-1')">Figure 3.2.2.1</a> (after the removal of <strong>low-count genes</strong> and <strong>outlier samples</strong>) provides an overview of the <strong>log2-transformed gene expression counts</strong> across all samples without any group-based color distinction. It allows us to quickly assess the range of counts for each sample and identify potential <strong>outliers</strong>. This uncolored version gives a broad view of <strong>data distribution</strong> and helps to highlight <strong>sample-level variations</strong> after the removal of <strong>low-count genes</strong> and <strong>outlier samples</strong>, ensuring the data is cleaned and ready for downstream analyses.
	        </li>
	    </ul>
	
	    <ul>
	        <li>
	            In this code (Code Block 3.2.2.1), we create a boxplot for the <strong>log2-transformed counts</strong> of the count matrix. (Step 1): We load the <strong>ggplot2</strong> library to generate the plot. (Step 2): The count matrix is <strong>log2-transformed</strong> and converted into a long format for visualization. (Step 3): A basic boxplot is created with minimal styling using <strong>geom_boxplot()</strong> to show the count distribution across samples. (Step 4): The plot is saved to a specific location using the <strong>ggsave()</strong> function.
	        </li>
	    </ul>
	</div>
	

<!-- Code Block 3.2.2.1. Boxplot of Raw Counts (Uncolored) -->
<pre><code class="language-r">
# ============================
# Step 1: Load necessary library
# ============================
library(ggplot2)

# ============================
# Step 2: Prepare Data for Plotting
# ============================
# Convert counts_matrix to a data frame and log-transform it
df <- as.data.frame(log2(counts_matrix + 1))  # Log2 transform the counts matrix

# Add a sample column (rownames will become a new column for plotting)
df$Sample <- rownames(df)

# Reshape the data for ggplot2 (long format)
df_long <- reshape2::melt(df, id.vars = "Sample")

# ============================
# Step 3: Create Boxplot
# ============================
p <- ggplot(df_long, aes(x = variable, y = value)) +
  geom_boxplot() +  # Create boxplot
  theme_minimal() +  # Apply a minimal theme for better readability
  labs(title = "Log2 Raw Counts Across Samples", x = "Samples", y = "Log2 Counts") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4),
        plot.background = element_rect(fill = "white", colour = NA),  # Set white background
        panel.background = element_rect(fill = "white", colour = NA))  # Set white background for the panel

# ============================
# Step 4: Save the Plot
# ============================
ggsave("C:/Users/omidm/OneDrive/Desktop/RNA_Seq_Task1/3/3_Count_Matrix_Exploration/3.2.2.1.Uncolored_Boxplot_Raw_Counts_After_Removing_LowCountGenes_AND_Outlier_Samples.png", 
       plot = p, width = 13, height = 4)
</code></pre>

<!-- ==============================(Figure 3.2.2.1)================================== --> 

<figure id="figure-3-2-2-1" style="text-align: justify;">
    <!-- Add a clickable link to enlarge the image -->
    <a href="Pictures/RNA_Seq_Task1/3.2.2.1.Uncolored_Boxplot_Raw_Counts_After_Removing_LowCountGenes_AND_Outlier_Samples.png" target="_blank">
        <img src="Pictures/RNA_Seq_Task1/3.2.2.1.Uncolored_Boxplot_Raw_Counts_After_Removing_LowCountGenes_AND_Outlier_Samples.png" alt="Boxplot of Raw Counts (Uncolored)" style="display: block; background-color: #f0f0f0; padding: 20px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 400px;">
    </a>
    <figcaption id="figure-caption-3-2-2-1">
        <strong>Figure 3.2.2.1</strong>. Boxplot of log2-transformed gene expression counts across all samples, after removing low-count genes and outlier samples. This uncolored boxplot provides an overview of the distribution of gene counts across samples, helping to identify potential outliers and ensuring consistency in sequencing depth.
    </figcaption>
</figure>
		

<!-- =========================  start of 3.2.4.======================================= --> 

		
		<div class="explanation">
    <h4>3.2.4. Determining the Optimal Gene Count for Heatmap (Cumulative Variance Explained Plot)</h4>
    <ul>
        <li>
            <strong>Heatmaps</strong> are primarily exploratory tools to visually assess patterns in the data. The goal is to select enough genes to reveal meaningful clusters without overcomplicating the visualization. If <u>too many genes are included</u>, the heatmap can <u>become cluttered</u> and less informative. On the other hand, if <u>too few</u> are used, <u>important patterns may be missed</u>. Typically, 100 to 500 of the most variable genes are used for exploratory heatmaps in <strong>RNA-seq studies</strong>. To ensure clarity, we often start by testing heatmaps with the top 100, 200, 300, and 500 most variable genes, assessing how well they cluster and separate groups.
        </li>
        <li>
            However, a more data-driven approach can be taken by calculating the <strong>variance</strong> for all genes and selecting the number of genes that explains a specific proportion of the total variance. This method ensures that we capture the majority of variability in our data without including too many redundant or uninformative genes. By examining the curve of <strong>cumulative variance</strong>, we can choose a number of genes that explains a high proportion of variance, focusing on the point where the curve starts to flatten ((Code Block 3.2.4; <a href="#figure-3-2-4" onclick="highlightFigure('3-2-4')">Figure 3.2.4</a>) ).
        </li>
    </ul>




	<div class="explanation">
    <ul>
        <li>
            This code (Code Block 3.2.4) focuses on analyzing gene expression variability. <strong>(Step 1)</strong>: Required libraries like <code><a href="https://cran.r-project.org/web/packages/matrixStats/index.html" target="_blank">matrixStats</a></code> and <code><a href="https://ggplot2.tidyverse.org/" target="_blank">ggplot2</a></code> are loaded for variance calculations and plotting. <strong>(Step 2)</strong>: The gene expression data in <code>counts_matrix</code> is log2-transformed to reduce its dynamic range, making it easier to interpret. <strong>(Step 3)</strong>: Using the <code><a href="https://www.rdocumentation.org/packages/matrixStats/versions/0.62.0/topics/rowVars" target="_blank">rowVars()</a></code> function, the variance of each gene across all samples is calculated, identifying highly variable genes for further analysis. <strong>(Step 4)</strong>: The cumulative variance is computed by sorting these variances and calculating their cumulative sum, which helps assess how much variability is captured by the top genes. <strong>(Step 5)</strong>: Finally, a line plot is generated (<a href="#figure-3-2-4" onclick="highlightFigure('3-2-4')">Figure 3.2.4</a>) using <code><a href="https://ggplot2.tidyverse.org/" target="_blank">ggplot2</a></code> to visualize the cumulative variance explained by an increasing number of genes, aiding in the selection of the optimal number of genes for further analysis.
        </li>
    </ul>
	</div> 

		
<!-- ================================ Code 3.2.4.================================ --> 
		
	<!-- Caption for the code block -->
	<p class="code-caption">Code Block 3.2.4. Cumulative Variance Plot to Determine Optimal Gene Count for Heatmap</p>
			
    <div class="code-block">
        <pre><code class="language-r">
# =========== Step 1: Load Required Libraries =============
library(matrixStats)  # Or DelayedMatrixStats for variance calculations
library(ggplot2)      # For enhanced plotting capabilities

# =========== Step 2: Log2 Transformation =============
# Convert counts_matrix to a matrix and apply log2 transformation
# Log transformation reduces the dynamic range of the data, making it easier to interpret
counts_matrix_log <- log2(as.matrix(counts_matrix) + 1) 

# =========== Step 3: Calculate Gene Variances =============
# Use the rowVars() function to calculate the variance for each gene across samples
# Gene variance is used to identify the most variable genes for further analysis
gene_variances <- rowVars(counts_matrix_log)

# =========== Step 4: Calculate Cumulative Variance =============
# Sort the variances in descending order and calculate the cumulative sum
cum_variance <- cumsum(sort(gene_variances, decreasing = TRUE)) / sum(gene_variances)

# =========== Step 5: Plot Cumulative Variance using ggplot2 for enhanced plotting =============
# Plot the cumulative proportion of variance explained as the number of genes increases
# This plot will help visualize how many top genes are needed to explain a high proportion of variance
ggplot(data.frame(Genes = 1:length(cum_variance), CumulativeVariance = cum_variance), aes(x = Genes, y = CumulativeVariance)) +
  geom_line() +
  labs(title = "Cumulative Variance Explained by Top Genes", 
       x = "Number of Genes", 
       y = "Cumulative Proportion of Variance Explained") +
  theme_minimal()
        </code></pre>
    </div>
</div>

	<!-- ======= 3.2.4 image with caption =========== -->
	<figure id="figure-3-2-4" style="text-align: justify;">
	    <!-- Add a clickable link to enlarge the image -->
	    <a href="Pictures/RNA_Seq_Task1/optimal_gene_count_heatmap_cumulative_variance.png" target="_blank">
	        <img src="Pictures/RNA_Seq_Task1/optimal_gene_count_heatmap_cumulative_variance.png" alt="Cumulative Variance Plot" style="display: block; background-color: #f0f0f0; padding: 20px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); ; width: 65%; height: 450px;">
	    </a>
	    <figcaption id="figure-caption-3-2-4">
	        Figure 3.2.4. Cumulative Variance Plot to Determine Optimal Gene Count for Exploratory Heatmaps after Low-Count Gene Removal.
	    </figcaption>
	</figure>

<div class="explanation">
    <ul>
        <li>
            The plot above (<a href="#figure-3-2-4" onclick="highlightFigure('3-2-4')">Figure 3.2.4</a>) shows that the curve, with a strict focus, starts to flatten around 300 genes, where additional genes contribute diminishing returns in terms of explaining the total variance. This suggests that selecting approximately 300 genes for the heatmap would balance between capturing significant variability and avoiding unnecessary noise.
        </li>
        
    </ul>
</div>


		<div class="explanation">
    <h4>3.2.5. Exploratory Heatmaps for Gene Expression Data</h4>
    <ul>
        <li> 
            In this section, we present a series of <strong>heatmaps</strong> to explore and visualize the <strong>count data</strong> before proceeding with differential expression analysis (DEA) using <strong>DESeq2</strong>. These heatmaps allow us to understand "the structure and relationships within the data", helping identify patterns such as "clustering of samples", "variations across experimental conditions", or potential "batch effects".
        </li>
        <li>
            We employ two types of heatmaps for this exploratory phase: 
            <strong>"Unsupervised</strong> Gene Expression Heatmaps" and <strong>"Grouped</strong> Gene Expression Heatmaps".
        </li>
        <li> 
            <strong>1. Unsupervised Gene Expression Heatmaps</strong>: The data is clustered purely based on "gene expression patterns", without taking the predefined  "experimental conditions" into account. This provides an  unbiased "view of the data", revealing "natural groupings" and potential  "outliers".
        </li>
        <li>
            <strong>2. Grouped Gene Expression Heatmaps</strong>: These heatmaps focus on "specific groups" of interest, allowing for a "more targeted comparison between predefined conditions" (e.g., lesional vs. non-lesional samples, or treatment vs. baseline). This can provide insight into how specific groups of samples behave in relation to one another.
        </li>
        <li>
            For all heatmaps, we focus on the "top 300 most variable genes", as this strikes a balance between capturing "sufficient variation" and maintaining "clarity in the visualizations".
        </li>
    </ul>
</div>

<div class="explanation">
    <h3>Unsupervised Heatmaps</h3>
	<h4 style="margin-top: 5px;">3.2.5.1. Unsupervised Heatmap for All Samples (160 samples)</h4>
    <ul>
        <li>
            As is shown in <a href="#figure-3-2-5-1" onclick="highlightFigure('3-2-5-1')">Figure 3.2.5.1</a>, this heatmap clusters all 160 "samples" based on the expression of the top 300 most variable "genes". The counts matrix is "log-transformed", and both rows ("genes") and columns ("samples") are clustered.
        </li>
        <li>
            In this code (Code Block 3.2.5.1), we begin by loading the "<strong>matrixStats</strong> library" to work with matrix data and the "<strong>pheatmap</strong> library" for generating heatmaps. First (Step 1), the "<strong>as.matrix()</strong> function" converts the counts_matrix into a matrix format if it was originally a data frame, ensuring compatibility with downstream operations. Then (Step 2), we apply a "<strong>log2 transformation</strong>" to the matrix to "reduce the dynamic range" and "make the data more suitable for visualization". Next (Step 3), the top 300 most variable genes are selected based on row variance calculated from the log-transformed counts. Finally (Step 4), a heatmap is generated (<a href="#figure-3-2-5-1" onclick="highlightFigure('3-2-5-1')">Figure 3.2.5.1</a>) using <strong>pheatmap()</strong>, with options to cluster rows and columns, adjust axis label angles, and font size, and the output is saved as an image file.
        </li>
    </ul>
</div>

<!-- Caption for the code block -->
<p class="code-caption">Code Block 3.2.5.1. Unsupervised Heatmap for All Samples (160 samples)</p>

<div class="code-block">
    <pre><code class="language-r">
# ============ Load Required Libraries ============
# Load the required libraries for matrix operations and heatmap generation
library(matrixStats)  # Ensure matrixStats is loaded for row variance calculation
library(pheatmap)     # For generating heatmaps

# ============ Step 1: Convert counts_matrix to Matrix ============
# Convert counts_matrix to a matrix if it is currently a data frame
counts_matrix <- as.matrix(counts_matrix)  # Ensures compatibility with downstream functions

# ============ Step 2: Log2 Transformation of Counts ============
# Apply a log2 transformation to reduce the dynamic range of the count data
counts_matrix_log <- log2(counts_matrix + 1)  # Adding 1 to avoid log(0) issues

# ============ Step 3: Identify Top Variable Genes ============
# Recalculate the most variable genes based on the log-transformed counts
# We select the top 300 most variable genes using row variance
top_var_genes_log <- head(order(rowVars(counts_matrix_log), decreasing = TRUE), 300)  

# ============ Step 4: Generate Heatmap and Save ============
# Create the heatmap for all 166 samples based on the top 300 most variable genes
# Adjust clustering and visual parameters such as label angles and font sizes
pheatmap(counts_matrix_log[top_var_genes_log, ], 
         cluster_rows = TRUE, cluster_cols = TRUE, 
         show_rownames = FALSE, show_colnames = TRUE,  
         angle_col = 90,  # Rotate x-axis labels for better readability
         fontsize_col = 4,  # Reduce font size for the column labels
         filename = "path/to/your/output/V1_300_Genes_heatmap_variable_genes.png")  # Save the heatmap as an image
    </code></pre>
</div>


		
 	<!-- Heatmaps Row with Click-to-Enlarge Feature -->
	<div style="display: flex; justify-content: space-around;">
	    
	    <!-- Heatmap Figure 3.2.5.1. (160/unsupervised) -->
	    <figure id="figure-3-2-5-1" style="text-align: justify; margin: 10px;">
	        <a href="Pictures/RNA_Seq_Task1/9_Figure3.2.5.1_Unsupervised_Heatmap_160_Samples_300_Genes.png" target="_blank">
	            <img src="Pictures/RNA_Seq_Task1/9_Figure3.2.5.1_Unsupervised_Heatmap_160_Samples_300_Genes.png" alt="Heatmap 1" style="display: block; background-color: #0c4b4f; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 85%; height: 80%;">
	        </a>
	        <figcaption id="figure-caption-3-2-5-1">Figure 3.2.5.1. Unsupervised Gene Expression Heatmaps for All Samples (160 samples) with the top 300 most variable genes (After filtering out outlier samples & Low-Count Genes).</figcaption>
	    </figure>
	
	    <!-- Figure 3.2.5.2. (109/unsupervised) -->
	    <figure id="figure-3-2-5-2" style="text-align: justify; margin: 10px;">
	        <a href="Pictures/RNA_Seq_Task1/10_Figure3.2.5.2_Unsupervised_Heatmap_109_Samples_300_Genes.png" target="_blank">
	            <img src="Pictures/RNA_Seq_Task1/10_Figure3.2.5.2_Unsupervised_Heatmap_109_Samples_300_Genes.png" alt="Heatmap 2" style="display: block; background-color: #0c4b4f; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 85%; height: 80%;;">
	        </a>
	        <figcaption id="figure-caption-3-2-5-2">Figure 3.2.5.2. Unsupervised Gene Expression Heatmaps for Baseline Lesional and Non-lesional Samples (109 samples) with the top 300 most variable genes  (After filtering out outlier samples & Low-Count Genes).</figcaption>
	    </figure>
	
	</div>

<br>
<br>
		
<div class="explanation">
    <ul>
        <li>
            <strong>Interpretation:</strong> This heatmap (<a href="#figure-3-2-5-1" onclick="highlightFigure('3-2-5-1')">Figure 3.2.5.1</a>) provides an overview of how the "gene expression patterns" vary across all "samples." It shows "distinct clusters of samples" (at the top of the heatmap) based solely on their expression data (genes on the left of the heatmap), without considering any experimental conditions. This type of unsupervised clustering can reveal "natural groupings" within the data or highlight potential "outliers."
        </li>
    </ul>
</div>

		 



		<div class="explanation">
			<h4 style="margin-top: 5px;">3.2.5.2. Unsupervised Heatmap for Baseline Lesional and Non-lesional Samples (109 samples)</h4>
		  <ul>

	            <li>
		     <strong>Code Overview:</strong> This heatmap (<a href="#figure-3-2-5-2" onclick="highlightFigure('3-2-5-2')">Figure 3.2.5.2</a>) focuses on a subset of 109 samples (lesional and non-lesional) to compare expression patterns between baseline lesional and non-lesional samples.
		    </li>
			  
		    <li>
		      In this code (Code Block 3.2.5.2), we focus on comparing baseline lesional and non-lesional samples. <strong>Load Required Libraries:</strong> First, the <code><a href="https://cran.r-project.org/web/packages/matrixStats/index.html" target="_blank">matrixStats</a></code> and <code><a href="https://cran.r-project.org/web/packages/pheatmap/index.html" target="_blank">pheatmap</a></code> libraries are loaded for matrix operations and heatmap generation. <strong>(Step 1)</strong>: The metadata is subset to include only the baseline lesional (AL_m0) and non-lesional (AN_m0) samples by filtering based on <code>metadata$title</code>. These subsets are combined into one dataset for comparison. <strong>(Step 2)</strong>: The <code>counts_matrix</code> is filtered to include only the lesional and non-lesional samples based on the sample names in <code>metadata$title</code>. <strong>(Step 3)</strong>: A log2 transformation is applied to the filtered count matrix using <code>log2()</code> to reduce the dynamic range. <strong>(Step 4)</strong>: The top 300 most variable genes are identified based on variance using <code><a href="https://www.rdocumentation.org/packages/matrixStats/versions/0.62.0/topics/rowVars" target="_blank">rowVars()</a></code>. <strong>(Step 5)</strong>: A heatmap is generated (<a href="#figure-3-2-5-2" onclick="highlightFigure('3-2-5-2')">Figure 3.2.5.2</a>) using <code><a href="https://cran.r-project.org/web/packages/pheatmap/index.html" target="_blank">pheatmap</a></code>, with rows and columns clustered to visualize the relationship between samples and gene expression. Adjustments are made for label angles and font size, and the heatmap is saved as an image file.
		    </li>
		  </ul>
		</div>


<!-- Caption for the code block -->
<p class="code-caption">Code Block 3.2.5.2. Unsupervised Heatmap for Baseline Lesional and Non-lesional Samples (109 samples)</p>

<div class="code-block">
    <pre><code class="language-r">
# ============ Load Required Libraries ============
# Load the required libraries for matrix operations and heatmap generation
library(matrixStats)  # Ensure matrixStats is loaded for row variance calculation
library(pheatmap)     # For generating heatmaps

# ============ Step 1: Subset Metadata for Lesional and Non-lesional Samples ============
# Subset the metadata to include only the baseline lesional (AL_m0) and non-lesional (AN_m0) samples
lesional_samples <- metadata[grepl("AL_m0", metadata$title), ]  # Filter metadata for lesional samples
non_lesional_samples <- metadata[grepl("AN_m0", metadata$title), ]  # Filter metadata for non-lesional samples

# Combine lesional and non-lesional samples into one dataset for comparison
selected_samples <- rbind(lesional_samples, non_lesional_samples)

# ============ Step 2: Subset the Count Matrix ============
# Subset the count matrix to include only the lesional and non-lesional samples
# Assuming the sample names (columns) in counts_matrix match those in metadata$title
selected_sample_names <- selected_samples$title
counts_matrix_filtered <- counts_matrix[, selected_sample_names]  # Filter the count matrix for the selected samples

# ============ Step 3: Log2 Transformation of Filtered Counts ============
# Apply a log2 transformation to the filtered count matrix to reduce the dynamic range
counts_matrix_log <- log2(as.matrix(counts_matrix_filtered) + 1)  # Adding 1 to avoid log(0) issues

# ============ Step 4: Identify Top Variable Genes ============
# Recalculate the most variable genes based on the log-transformed counts
# Select the top 300 most variable genes
top_var_genes_log <- head(order(rowVars(counts_matrix_log), decreasing = TRUE), 300)  

# ============ Step 5: Generate Heatmap and Save ============
# Create a heatmap for the lesional and non-lesional samples based on the top 300 most variable genes
# Adjust clustering and visual parameters such as label angles and font sizes
pheatmap(counts_matrix_log[top_var_genes_log, ], 
         cluster_rows = TRUE, cluster_cols = TRUE, 
         show_rownames = FALSE, show_colnames = TRUE,  
         angle_col = 90,  # Rotate x-axis labels for better readability
         fontsize_col = 4,  # Reduce font size for the column labels
         filename = "path/to/your/output/V1.1_300_Genes_Lesional_NonLesional_heatmap.png")  # Save the heatmap as an image
    </code></pre>
</div>


<div class="explanation">
    <ul>
        <li>
            <strong>Interpretation:</strong> This unsupervised heatmap (see <a href="#figure-3-2-5-2" onclick="highlightFigure('3-2-5-2')">Figure 3.2.5.2</a> above) specifically examines how gene expression varies between baseline lesional and non-lesional samples. The clustering shows whether the lesional and non-lesional samples form distinct groups based on their gene expression, helping to assess the strength of separation between these two conditions.
        </li>
    </ul>
</div>



	<!-- Grouped Gene Expression Heatmaps -->
<div class="explanation">
    <h3>Grouped Heatmaps</h3>
	<h4 style="margin-top: 5px;">3.2.5.3. Grouped Heatmap for All Groups </h4>
    <ul>
        <li>This heatmap (<a href="#figure-3-2-5-3" onclick="highlightFigure('3-2-5-3')">Figure 3.2.5.3</a>) compares six different groups (<strong>baseline lesional</strong>, <strong>baseline non-lesional</strong>, <strong>cyclosporine lesional</strong>, <strong>cyclosporine non-lesional</strong>, <strong>dupilumab lesional</strong>, and <strong>dupilumab non-lesional</strong>).</li>
        
        <li><strong>Code Overview:</strong> In this code, we begin by loading the <strong>matrixStats</strong> and <strong>pheatmap</strong> libraries to handle matrix operations and generate heatmaps. First (Step 1), we apply a <strong>log2 transformation</strong> to the <strong>counts_matrix</strong> to reduce the dynamic range of the data. Next (Step 2), the <strong>sample_groups</strong> are extracted from <strong>metadata$<a href="#figure-3-1-2" onclick="highlightFigure('3-1-2')">source_name_ch1</a></strong>, representing the original group labels. We then (Step 3) define a <strong>new_labels</strong> vector, which maps the original group names (e.g., 'm0_AL') to more descriptive labels (e.g., 'Baseline Lesional').</li>
        
        <li>In Step 3.1, the <strong>selected_groups</strong> vector allows for different comparisons that provide insights into the data. For example, <strong>Lesional vs. Non-lesional</strong> comparisons (e.g., baseline (<a href="#figure-3-2-5-4" onclick="highlightFigure('3-2-5-4')">Figure 3.2.5.4</a>), cyclosporine (<a href="#figure-3-2-5-5" onclick="highlightFigure('3-2-5-5')">Figure 3.2.5.5</a>), dupilumab (<a href="#figure-3-2-5-6" onclick="highlightFigure('3-2-5-6')">Figure 3.2.5.6</a>) explore how gene expression differs between affected and unaffected skin; <strong>Therapy Comparisons</strong> (e.g., "Baseline Non-Lesional" vs. "Baseline Lesional", "Cyclosporine Lesional", and "Dupilumab Lesional") investigate how lesional samples respond to different treatments (<a href="#figure-3-2-5-7" onclick="highlightFigure('3-2-5-7')">Figure 3.2.5.7</a>); and <strong>Pre-treatment vs. Post-treatment comparisons</strong> assess cyclosporine or dupilumab effectiveness by examining gene expression changes before and after treatment (<a href="#figure-3-2-5-9" onclick="highlightFigure('3-2-5-9')">Figure 3.2.5.9</a> & <a href="#figure-3-2-5-10" onclick="highlightFigure('3-2-5-10')">Figure 3.2.5.10</a>) . These comparisons are crucial for understanding both disease pathology and treatment effects.</li>
        
        <li>Afterward (Step 4), the columns of <strong>counts_matrix_log</strong> are reordered based on the selected groups, and the column names are updated using the new descriptive labels. In (Step 5), then the <strong>top 300 most variable genes</strong> are selected based on the variance of the log-transformed counts. Finally (Step 6), a heatmap is generated with the updated column labels, and the output is saved as an image file.</li>
    </ul>
</div>

<!-- Code Block for Heatmap for All Groups -->
<p class="code-caption">Code Block 3.2.5.3. Grouped Heatmap for All Groups</p>
<div class="code-block">
    <pre><code class="language-r">
# =========== Load Required Libraries ===========
library(matrixStats)
library(pheatmap)

# =========== Step 1: Apply Log2 Transformation ===========
counts_matrix_log <- log2(as.matrix(counts_matrix) + 1)

# =========== Step 2: Extract Sample Grouping Information ===========
sample_groups <- metadata$source_name_ch1

# =========== Step 3: Define Descriptive Labels ===========
new_labels <- c(
  "m0_AN" = "Baseline Non-lesional",
  "cyclosporine_m3_AN" = "Cyclosporine Non-lesional",
  "dupilumab_m3_AN" = "Dupilumab Non-lesional",
  "m0_AL" = "Baseline Lesional",
  "cyclosporine_m3_AL" = "Cyclosporine Lesional",
  "dupilumab_m3_AL" = "Dupilumab Lesional"
)
	
# =================================================================================
# =========== Step 3.1: Select Groups for Analysis ===========
selected_groups <- c("m0_AN", "cyclosporine_m3_AN", "dupilumab_m3_AN", "m0_AL", "cyclosporine_m3_AL", "dupilumab_m3_AL")

# ===== we can replace the above selected_groups with one of the bellow  ===== 
# 1. Heatmap for all groups:
# c("m0_AN", "cyclosporine_m3_AN", "dupilumab_m3_AN", "m0_AL", "cyclosporine_m3_AL", "dupilumab_m3_AL")

# 2. (Lesional vs. Non-lesional) Compare "Baseline Lesional" with "Baseline Non-lesional": 
# c("m0_AN", "m0_AL")

# 3. (Lesional vs. Non-lesional) Compare Cyclosporine Lesional with Cyclosporine Non-lesional:
# c("cyclosporine_m3_AN", "cyclosporine_m3_AL") 

# 4. (Lesional vs. Non-lesional) Compare Dupilumab Lesional with Dupilumab Non-lesional:
# c("dupilumab_m3_AN", "dupilumab_m3_AL") 

# 5. (Therapy Comparisons) Compare Baseline Lesional, Cyclosporine Lesional, and Dupilumab Lesional (compared to Baseline Non-Lesional).
# c("m0_AN", "m0_AL", "cyclosporine_m3_AL", "dupilumab_m3_AL")  

# 6. (Therapy Comparisons) Compare Dupilumab Lesional and Cyclosporine Lesional.
# c("dupilumab_m3_AL", "cyclosporine_m3_AL")

# 7. (Pre-treatment vs. Post-treatment) Compare Baseline Lesional & Cyclosporine Lesional.
# c("m0_AL", "cyclosporine_m3_AL")

# 8. (Pre-treatment vs. Post-treatment) Compare Baseline Lesional & Dupilumab Lesional.
# c("m0_AL", "dupilumab_m3_AL")
# =================================================================================

	
# =========== Step 4: Reorder Columns Based on Group Selection ===========
desired_order <- selected_groups
reordered_columns <- match(desired_order, sample_groups)
counts_matrix_log <- counts_matrix_log[, reordered_columns]
colnames(counts_matrix_log) <- new_labels[sample_groups[reordered_columns]]

# =========== Step 5: Calculate Top Variable Genes ===========
top_var_genes_log <- head(order(rowVars(counts_matrix_log), decreasing = TRUE), 300)

# =========== Step 6: Generate the Heatmap ===========
pheatmap(counts_matrix_log[top_var_genes_log, ], 
         cluster_rows = TRUE, cluster_cols = TRUE,
         show_rownames = FALSE, show_colnames = TRUE,
         angle = 45, vjust = 0.5, hjust = 0.6,
         fontsize_col = 8, 
         filename = "your/path/here/1_Grouped_Heatmap_for_All_Groups.png")
    </code></pre>
</div>

<!-- Interpretation for Heatmap for All Groups -->
<div class="explanation">
    <ul>
        <li><strong>Interpretation:</strong> As is shown in <a href="#figure-3-2-5-3" onclick="highlightFigure('3-2-5-3')">Figure 3.2.5.3</a>, this heatmap allows a broad comparison between all six groups. It helps assess how different treatments (cyclosporine and dupilumab) affect lesional and non-lesional samples, as well as providing insights into baseline differences between lesional and non-lesional samples.</li>
    </ul>
</div>

<!-- Further Comparisons -->
<div class="explanation">
   
    <h4 style="margin-top: 5px;">3.2.5.4. Grouped Heatmap to Compare "Baseline Lesional" with "Baseline Non-lesional" (Lesional vs. Non-lesional) </h4>
    <ul>
          <li> This heatmap (Code Block 3.2.5.4; <a href="#figure-3-2-5-4" onclick="highlightFigure('3-2-5-4')">Figure 3.2.5.4</a>) focuses on comparing "baseline lesional" and "baseline non-lesional" samples.</li>
          <li>This comparison between <strong>Baseline Lesional</strong> and <strong>Baseline Non-lesional</strong> is crucial for identifying 
    differentially expressed genes (<strong>DEGs</strong>) that distinguish <strong>diseased (lesional)</strong> skin from <strong>healthy (non-lesional)</strong> skin.</li>
	  <li>Firstly, these <strong>DEGs</strong> can serve <strong>diagnostic</strong> purposes, helping to identify <strong>biomarkers</strong> that differentiate <strong>Atopic Dermatitis (AD)</strong> from unaffected skin.</li>
	  <li>Secondly, understanding the <strong>baseline differences</strong> in gene expression allows for monitoring how treatments, such as <strong>Cyclosporine</strong> or <strong>Dupilumab</strong>, bring lesional skin back towards the <strong>non-lesional</strong> state, thereby evaluating <strong>treatment effectiveness</strong>. By comparing post-treatment samples with <strong>non-lesional baseline</strong> samples, we can assess which therapy restores gene expression closer to the <strong>non-lesional (healthy) state</strong>, which is important for evaluating the <strong>therapeutic impact</strong> and determining which treatment works best for <strong>normalizing skin condition</strong>.</li>
    </ul>
</div>

<!-- Code Block for Baseline Lesional vs. Non-lesional -->
<p class="code-caption">Code Block 3.2.5.4. Grouped Heatmap: Compare Baseline Lesional with Baseline Non-lesional</p>
<div class="code-block">
    <pre><code class="language-r">
# ============================
selected_groups <- c("m0_AN", "m0_AL")
# ============================
    </code></pre>
</div>

<!-- Further Comparisons for Cyclosporine, Dupilumab -->
<div class="explanation">
    <h4 style="margin-top: 5px;">3.2.5.5. Grouped Heatmap to Compare Cyclosporine Lesional vs. Cyclosporine Non-lesional (Lesional vs. Non-lesional) </h4>
    <ul>
        <li>This heatmap (Code Block 3.2.5.5. & <a href="#figure-3-2-5-5" onclick="highlightFigure('3-2-5-5')">Figure 3.2.5.5</a>) compares lesional and non-lesional samples treated with cyclosporine.</li>
        <li>By comparing <strong>Cyclosporine Lesional</strong> to <strong>Cyclosporine Non-lesional</strong>, we are assessing the <strong>Therapeutic Effectiveness</strong> and <strong>Monitoring Treatment Impact</strong>. The focus is on observing how the treatment affects gene expression in both lesional and non-lesional skin, looking for any therapeutic improvements or unintended side effects, which falls under <strong>Monitoring Treatment Impact</strong>.</li>
	<li><strong>Firstly</strong>, this comparison is crucial for determining whether Cyclosporine modulates gene expression in lesional skin towards a more normalized state (<strong>Therapeutic Effectiveness</strong>).</li>
	<li><strong>Secondly</strong>, it examines the effects on non-lesional skin, potentially revealing any unintended gene expression changes in unaffected tissue (<strong>Monitoring Treatment Impact</strong>).</li>
	<li><strong>Therefore</strong>, understanding these differences provides valuable insights into the treatment’s localized effectiveness and highlights ongoing gene expression disparities between treated lesional and treated non-lesional skin (<strong>Therapeutic Effectiveness</strong> and <strong>Monitoring</strong>).</li>

    </ul>
</div>

<p class="code-caption">Code Block 3.2.5.5. Grouped Heatmap: Compare Cyclosporine Lesional vs. Non-lesional</p>
<div class="code-block">
    <pre><code class="language-r">
# ============================
selected_groups <- c("cyclosporine_m3_AN", "cyclosporine_m3_AL")
# ============================
    </code></pre>
</div>

<!-- Continue with Dupilumab, Therapy Comparisons -->
<div class="explanation">
    <h4 style="margin-top: 5px;">3.2.5.6. Grouped Heatmap to Compare Dupilumab Lesional vs. Dupilumab Non-lesional (Lesional vs. Non-lesional) </h4>
    <ul>
        <li>This heatmap (Code Block 3.2.5.6 & <a href="#figure-3-2-5-6" onclick="highlightFigure('3-2-5-6')">Figure 3.2.5.6</a>) reveals how <strong>dupilumab treatment</strong> impacts gene expression across lesional and non-lesional samples.</li>
        
	<li>By comparing <strong>Dupilumab Lesional</strong> to <strong>Dupilumab Non-lesional</strong>, we are also assessing the <strong>Therapeutic Effectiveness</strong> and <strong>Monitoring Treatment Impact</strong>, similar to what was done for Cyclosporine. The focus remains on observing whether Dupilumab modulates gene expression in lesional skin towards a more normalized state and if there are any unintended changes in non-lesional skin, which highlights the treatment’s overall impact.</li>
	
	<li><strong>Firstly</strong>, this comparison is crucial for determining whether Dupilumab effectively restores the gene expression in lesional skin (Therapeutic Effectiveness).</li>
	
	<li><strong>Secondly</strong>, it reveals any unintended gene expression changes in the non-lesional skin, assessing the safety of the treatment on unaffected tissue (Monitoring Treatment Impact).</li>
	
	<li><strong>Therefore</strong>, understanding these gene expression differences offers insights into the localized therapeutic effects of Dupilumab, providing a similar perspective to the Cyclosporine comparison but focused on a different treatment (Therapeutic Effectiveness and Monitoring).</li>

    </ul>
</div>


	

<p class="code-caption">Code Block 3.2.5.6. Grouped Heatmap: Compare Dupilumab Lesional vs. Dupilumab Non-lesional</p>
<div class="code-block">
    <pre><code class="language-r">
# ============================
selected_groups <- c("dupilumab_m3_AN", "dupilumab_m3_AL")
# ============================
    </code></pre>
</div>


<!-- Heatmaps Row with Click-to-Enlarge Feature -->
<div style="display: flex; justify-content: space-around;">
    
    <!-- Heatmap Figure 3.2.5.3 (1_Heatmap_for_All_Groups) -->
    <figure id="figure-3-2-5-3" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/1_Figure3.2.5.3_Heatmap_for_All_Groups.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/1_Figure3.2.5.3_Heatmap_for_All_Groups.png" alt="Heatmap 1" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-3">
		<strong>Figure 3.2.5.3</strong> Grouped Gene Expression Heatmap across all six groups (Baseline Lesional, Baseline Non-lesional, Cyclosporine Lesional, Cyclosporine Non-lesional, Dupilumab Lesional, and Dupilumab Non-lesional).This allows for the broadest comparison of gene expression patterns across all groups  (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

    <!-- Heatmap Figure 3.2.5.4 (2_Baseline_Lesional_VS_Baseline_Non_lesional) -->
    <figure id="figure-3-2-5-4" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/2_Figure3.2.5.4_Heatmap_Baseline_Lesional_VS_Baseline_Non_lesional.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/2_Figure3.2.5.4_Heatmap_Baseline_Lesional_VS_Baseline_Non_lesional.png" alt="Heatmap 2" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-4">
		<strong>Figure 3.2.5.4.</strong> Grouped Heatmap: comparing Baseline Lesional and Baseline Non-lesional samples. This helps visualize how gene expression differs between affected and unaffected skin before any treatment is administered (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

    <!-- Heatmap Figure 3.2.5.5 (3_Cyclosporine_Lesional_VS_Cyclosporine_Non_lesional)-->
    <figure id="figure-3-2-5-5" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/3_Figure3.2.5.5_Heatmap_Cyclosporine_Lesional_VS_Cyclosporine_Non_lesional.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/3_Figure3.2.5.5_Heatmap_Cyclosporine_Lesional_VS_Cyclosporine_Non_lesional.png" alt="Heatmap 3" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-5">
		<strong>Figure 3.2.5.5.</strong> Grouped Gene Expression Heatmap comparing Cyclosporine Lesional and Cyclosporine Non-lesional samples. This focuses on how cyclosporine treatment impacts gene expression in affected vs. unaffected skin (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

    <!-- Heatmap Figure 3.2.5.6 (4_Dupilumab_Lesional_VS_Dupilumab_Non_lesional)-->
    <figure id="figure-3-2-5-6" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/4_Figure3.2.5.6_Heatmap_Dupilumab_Lesional_VS_Dupilumab_Non_lesional.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/4_Figure3.2.5.6_Heatmap_Dupilumab_Lesional_VS_Dupilumab_Non_lesional.png" alt="Heatmap 4" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-6">
		<strong>Figure 3.2.5.6.</strong> Grouped Gene Expression Heatmap comparing Dupilumab Lesional and Dupilumab Non-lesional samples. This visualizes the effect of dupilumab treatment on lesional and non-lesional samples (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

</div>


	

<!-- 5. Therapy Comparisons -->
<div class="explanation">
    <h4 style="margin-top: 5px;">3.2.5.7. Grouped Heatmap to Compare Baseline Lesional, Cyclosporine Lesional, and Dupilumab Lesional (compared to Baseline Non-Lesional ) (Therapy Comparisons) </h4>
    <ul>
        <li>This heatmap (Code Block 3.2.5.7. & <a href="#figure-3-2-5-7" onclick="highlightFigure('3-2-5-7')">Figure 3.2.5.7.</a>) compares <strong>lesional samples</strong> across three conditions: baseline, cyclosporine, and dupilumab treatment (in comparison with Baseline Non-Lesional). This comparison helps us to understand how <strong>lesional samples</strong> respond to different therapies and Which treatment, Cyclosporine or Dupilumab, is more effective in moving lesional skin towards a healthier or more normalized gene expression state, as compared to Baseline Non-Lesional?</li>
	<li>The comparison between <strong>Baseline Lesional</strong>, <strong>Cyclosporine Lesional</strong>, <strong>Dupilumab Lesional</strong>, and <strong>Baseline Non-Lesional</strong> helps assess the <strong>Therapeutic Effectiveness</strong> of two treatments—<strong>Cyclosporine</strong> and <strong>Dupilumab</strong>—on lesional skin, using <strong>Baseline Non-Lesional</strong> (healthy) as a reference. This comparison provides insights into how each treatment modulates the gene expression profile in lesional skin after therapy.</li>
	
	<li>Firstly, this comparison highlights the extent to which each treatment modulates lesional skin's gene expression, showing how well <strong>Dupilumab</strong> or <strong>Cyclosporine</strong> restores the lesional skin towards a healthier or more normalized state when compared to <strong>Baseline Non-Lesional</strong> (<strong>Therapeutic Effectiveness</strong>).</li>
	
	<li>Secondly, by comparing both treatments against the <strong>Baseline Non-Lesional</strong> and <strong>Baseline Lesional</strong> states, this analysis reveals that <strong>Dupilumab</strong> appears more successful in restoring gene expression, as it shows high similarity to <strong>Baseline Non-Lesional</strong> and they cluster closely, suggesting a stronger positive effect (<strong>Therapeutic Effectiveness</strong>). In contrast, <strong>Cyclosporine</strong> shows less similarity to <strong>Baseline Non-Lesional</strong> and the least similarity to the other conditions, suggesting a less effective outcome.</li>
	
	<li>Therefore, this comparison provides a clear assessment of the relative efficacy of <strong>Cyclosporine</strong> and <strong>Dupilumab</strong>, offering critical insights into which treatment is more effective in modulating the gene expression of lesional skin back towards a healthy state (<strong>Therapeutic Effectiveness</strong>).</li>

    </ul>
</div>

<p class="code-caption">Code Block 3.2.5.7. Grouped Heatmap: Compare Baseline Non-Lesional vs. Baseline Lesional, Cyclosporine Lesional, and Dupilumab Lesional</p>
<div class="code-block">
    <pre><code class="language-r">
# ============================
selected_groups <- c("m0_AN", "m0_AL", "cyclosporine_m3_AL", "dupilumab_m3_AL") 
# ============================
    </code></pre>
</div>

<!-- Dupilumab vs Cyclosporine -->
<div class="explanation">
    <h4 style="margin-top: 5px;">3.2.5.8. Grouped Heatmap to Compare Dupilumab Lesional vs. Cyclosporine Lesional (Therapy Comparisons) </h4>
    <ul>
        <li> This heatmap (Code Block 3.2.5.8 & <a href="#figure-3-2-5-8" onclick="highlightFigure('3-2-5-8')">Figure 3.2.5.8</a>) compares <strong>lesional samples</strong> treated with <strong>dupilumab</strong> versus <strong>cyclosporine</strong>. This comparison allows you to directly assess how gene expression varies between <strong>dupilumab</strong> and <strong>cyclosporine treatments</strong> in lesional samples.</li>
        <li>The comparison between <strong>Dupilumab Lesional</strong> and <strong>Cyclosporine Lesional</strong> focuses on identifying how these two treatments differentially influence gene expression in lesional skin. This analysis allows us to observe the unique gene expression changes induced by each therapy and to identify treatment-specific patterns.</li>
        <li>By examining the differentially expressed genes (DEGs) between these two treatment groups, we can uncover distinct molecular pathways targeted by Dupilumab and Cyclosporine. This comparison is essential for understanding how each treatment modulates the biological processes in lesional skin and for identifying any therapeutic pathways that may be more prominent in one treatment compared to the other.</li>
    	<li>Although this analysis does not directly reveal which treatment restores skin to a healthier state (since it lacks a non-lesional reference), it offers valuable insights into the <strong>mechanisms of action</strong> of both therapies and how they diverge in their effects on lesional skin.</li>

    </ul>
</div>

<p class="code-caption">Code Block 3.2.5.8. Grouped Heatmap: Compare Dupilumab Lesional vs. Cyclosporine Lesional</p>
<div class="code-block">
    <pre><code class="language-r">
# ============================
selected_groups <- c("dupilumab_m3_AL", "cyclosporine_m3_AL")
# ============================
    </code></pre>
</div>

<!-- Pre-treatment vs. Post-treatment -->
<div class="explanation">
    <h4 style="margin-top: 5px;">3.2.5.9. Grouped Heatmap to Compare Baseline Lesional vs. Cyclosporine Lesional (Pre-treatment vs. Post-treatment) </h4>
    <ul>
        <li> This heatmap (Code Block 3.2.5.9 & <a href="#figure-3-2-5-9" onclick="highlightFigure('3-2-5-9')">Figure 3.2.5.9</a>) compares <strong>pre-treatment</strong> (baseline lesional) to <strong>post-treatment</strong> (cyclosporine lesional) samples.</li>
        <li>The comparison between <strong>Baseline Lesional</strong> and <strong>Cyclosporine Lesional</strong> focuses on evaluating the effect of Cyclosporine on lesional skin by observing how the treatment alters gene expression post-treatment compared to the untreated baseline state. This comparison provides insights into the <strong>Therapeutic Effectiveness</strong> of Cyclosporine in modulating the gene expression profile of lesional skin.</li>

	<li>Firstly, this comparison helps determine the extent to which Cyclosporine shifts the gene expression in lesional skin towards a modified or improved state after treatment, relative to its pre-treatment condition (Baseline Lesional).</li>
	
	<li>Secondly, the comparison highlights the specific <strong>differentially expressed genes (DEGs)</strong> that are altered post-treatment, offering insights into the molecular changes and pathways modulated by Cyclosporine therapy.</li>
	
	<li>Thus, this analysis provides valuable data on how Cyclosporine influences lesional skin, reflecting its impact on the underlying disease processes at the gene expression level and suggesting its therapeutic potential in treating the condition.</li>

    </ul>
</div>

<p class="code-caption">Code Block 3.2.5.9. Grouped Heatmap: Compare Pre-treatment vs. Post-treatment (Baseline Lesional & Cyclosporine Lesional)</p>
<div class="code-block">
    <pre><code class="language-r">
# ============================
selected_groups <- c("m0_AL", "cyclosporine_m3_AL")
# ============================
    </code></pre>
</div>


<!-- Pre-treatment vs. Post-treatment -->
<div class="explanation">
    <h4 style="margin-top: 5px;">3.2.5.10. Grouped Heatmap to Compare Baseline Lesional vs. dupilumab Lesional (Pre-treatment vs. Post-treatment) </h4>
    <ul>
         <li>This heatmap (Code Block 3.2.5.10 & <a href="#figure-3-2-5-10" onclick="highlightFigure('3-2-5-10')">Figure 3.2.5.10</a>) compares <strong>pre-treatment</strong> (baseline lesional) to <strong>post-treatment</strong> (dupilumab lesional) samples.</li>
        <li>The comparison between <strong>Baseline Lesional</strong> and <strong>Dupilumab Lesional</strong> allows us to evaluate the <strong>Therapeutic Effectiveness</strong> of Dupilumab by analyzing how the treatment alters the gene expression profile in lesional skin after therapy, compared to its pre-treatment condition.</li>

	<li>Firstly, this comparison helps determine the extent to which Dupilumab modulates the gene expression of lesional skin, moving it towards an improved state, compared to its baseline (untreated) condition.</li>
	
	<li>Secondly, by identifying <strong>differentially expressed genes (DEGs)</strong> between the pre-treatment and post-treatment states, we gain insights into the molecular pathways and biological processes that are influenced by Dupilumab, offering a deeper understanding of how the treatment affects lesional skin at the genetic level.</li>
	
	<li>Thus, this comparison provides a critical assessment of how Dupilumab impacts lesional skin, shedding light on its potential to restore a more normal gene expression profile in affected tissue.</li>

    </ul>
</div>	

	<p class="code-caption">Code Block 3.2.5.10. Grouped Heatmap: Compare Pre-treatment vs. Post-treatment (Baseline Lesional & Dupilumab Lesional)</p>
	<div class="code-block">
	    <pre><code class="language-r">
	# ============================
	selected_groups <- c("m0_AL", "dupilumab_m3_AL")
	# ============================
	    </code></pre>
	</div>



	<!-- Heatmaps Row with Click-to-Enlarge Feature -->
<div style="display: flex; justify-content: space-around;">
    
    <!-- Heatmap Figure 3.2.5.7. (5_Baseline_Lesional_AND_Cyclosporine_Lesional_AND_Dupilumab_Lesional) -->
    <figure id="figure-3-2-5-7" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/5_Figure3.2.5.7_Heatmap_Baseline_Non_Lesional_AND_Baseline_Lesional_AND_Cyclosporine_Lesional_AND_Dupilumab_Lesional.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/5_Figure3.2.5.7_Heatmap_Baseline_Non_Lesional_AND_Baseline_Lesional_AND_Cyclosporine_Lesional_AND_Dupilumab_Lesional.png" alt="Heatmap 1" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-7">
		<strong>Figure 3.2.5.7.</strong> Grouped Gene Expression Heatmap comparing Baseline Non-Lesional vs. Baseline Lesional, Cyclosporine Lesional, and Dupilumab Lesional samples. This offers a direct comparison of how gene expression changes under different treatments (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

    <!-- Heatmap Figure 3.2.5.8. (6_Dupilumab_Lesional_VS_Cyclosporine_Lesional) -->
    <figure id="figure-3-2-5-8" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/6_Figure3.2.5.8_Heatmap_Dupilumab_Lesional_VS_Cyclosporine_Lesional.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/6_Figure3.2.5.8_Heatmap_Dupilumab_Lesional_VS_Cyclosporine_Lesional.png" alt="Heatmap 2" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-8">
		<strong>Figure 3.2.5.8.</strong> Grouped Gene Expression Heatmap comparing Dupilumab Lesional and Cyclosporine Lesional samples. This allows for the direct comparison of how these two treatments affect lesional skin (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

    <!-- Heatmap Figure 3.2.5.9. (7_Baseline_Lesional_VS_Cyclosporine_Lesional) -->
    <figure id="figure-3-2-5-9" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/7_Figure3.2.5.9_Heatmap_Baseline_Lesional_VS_Cyclosporine_Lesional.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/7_Figure3.2.5.9_Heatmap_Baseline_Lesional_VS_Cyclosporine_Lesional.png" alt="Heatmap 3" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-9">
		<strong>Figure 3.2.5.9.</strong> Grouped Gene Expression Heatmap comparing pre-treatment (Baseline Lesional) vs. post-treatment (Cyclosporine Lesional) samples. This assesses how gene expression changes following cyclosporine treatment (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

    <!-- Heatmap Figure 3.2.5.10. (8_Baseline_Lesional_VS_Dupilumab_Lesional) -->
    <figure id="figure-3-2-5-10" style="text-align: justify; margin: 10px;">
        <a href="Pictures/RNA_Seq_Task1/8_Figure3.2.5.10_Heatmap_Baseline_Lesional_VS_Dupilumab_Lesional.png" target="_blank">
            <img src="Pictures/RNA_Seq_Task1/8_Figure3.2.5.10_Heatmap_Baseline_Lesional_VS_Dupilumab_Lesional.png" alt="Heatmap 4" style="display: block; background-color: #f0f0f0; padding: 10px; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); width: 100%; height: 300px;">
        </a>
        <figcaption id="figure-caption-3-2-5-10">
		<strong>Figure 3.2.5.10.</strong> Grouped Gene Expression Heatmap comparing pre-treatment (Baseline Lesional) vs. post-treatment (Dupilumab Lesional) samples. This highlights how gene expression changes following dupilumab treatment (After filtering out outlier samples & Low-Count Genes).
	</figcaption>
    </figure>

</div>


	
		

 <!-- ====================== the bellow should be changed============================== -->
 <!-- ================================================================ -->
 <!-- ================================================================ -->
		
		 <!-- ============== A horizontal line ================== -->
				<!-- Add a horizontal line above the introduction -->
				<hr style="border: none; border-top: 1px solid black; margin: 20px 0;">
		 <!-- =================================================== -->
        

        <!-- ================================================================== -->

        <div class="explanation">
            <h3>)from here onward, everything will be replaced) <br> 1. Load Necessary Libraries</h3>
            <p>We begin by loading the essential R libraries needed for data manipulation, DEG analysis, and visualization.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Load Required Libraries
library(DESeq2)
library(data.table)
library(umap)
library(ggplot2)
library(clusterProfiler)
library(org.Hs.eg.db)
library(VennDiagram)
library(knitr)
library(tinytex)
            </code></pre>
        </div>






	
	
		
        <div class="explanation">
            <h3>2. Load and Prepare Data</h3>
	
            <p>This step involves downloading the count data and gene annotations from GEO. We convert these into suitable formats for further analysis.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Load counts table from GEO
urld <- "https://www.ncbi.nlm.nih.gov/geo/download/?format=file&type=rnaseq_counts"
path <- paste(urld, "acc=GSE157194", "file=GSE157194_raw_counts_GRCh38.p13_NCBI.tsv.gz", sep="&")
tbl <- as.matrix(data.table::fread(path, header=T, colClasses="integer"), rownames="GeneID")

# Load gene annotations 
apath <- paste(urld, "type=rnaseq_counts", "file=Human.GRCh38.p13.annot.tsv.gz", sep="&")
annot <- data.table::fread(apath, header=T, quote="", stringsAsFactors=F, data.table=F)
rownames(annot) <- annot$GeneID
            </code></pre>
        </div>

        <div class="explanation">
            <h3>3. Sample Selection and Group Assignment</h3>
            <p>This step filters the samples and assigns them to the Lesional or Non-Lesional groups based on predefined group labels.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Sample selection
gsms <- paste0("01101001010101011010011001011001011001101001011010",
               "01100101011010101001011001010101010010101010101001",
               "01100100110XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
               "XXXXXXXXXXXXXXXX")
sml <- strsplit(gsms, split="")[[1]]

# Filter out excluded samples (marked as "X")
sel <- which(sml != "X")
sml <- sml[sel]
tbl <- tbl[ ,sel]

# Group membership for samples
gs <- factor(sml)
groups <- make.names(c("Lesional","Non-Lesional"))
levels(gs) <- groups
sample_info <- data.frame(Group = gs, row.names = colnames(tbl))
            </code></pre>
        </div>

        <div class="explanation">
            <h3>4. Data Pre-Filtering</h3>
            <p>To improve analysis accuracy, we filter out genes with low counts across samples.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Pre-filter low count genes
keep <- rowSums(tbl >= 10) >= min(table(gs))
tbl <- tbl[keep, ]
            </code></pre>
        </div>

        <div class="explanation">
            <h3>5. Exploratory Data Analysis</h3>
            <p>Before proceeding with differential expression analysis, we perform a PCA to explore the variance in the dataset and ensure that the samples group as expected.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# PCA Plot
vsd <- vst(ds, blind=FALSE)
pcaData <- plotPCA(vsd, intgroup="Group", returnData=TRUE)
percentVar <- round(100 * attr(pcaData, "percentVar"))

ggplot(pcaData, aes(PC1, PC2, color=Group)) +
  geom_point(size=3) +
  xlab(paste0("PC1: ", percentVar[1], "% variance")) +
  ylab(paste0("PC2: ", percentVar[2], "% variance")) +
  coord_fixed() +
  theme_minimal()
            </code></pre>
        </div>

        <div class="explanation">
            <h3>6. Create DESeqDataSet and Run Differential Expression Analysis</h3>
            <p>We create a <code>DESeqDataSet</code> object, normalize the data, and run the differential expression analysis using DESeq2. This model tests for differences in gene expression between the Lesional and Non-Lesional groups.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Create DESeqDataSet and run DESeq2
ds <- DESeqDataSetFromMatrix(countData=tbl, colData=sample_info, design= ~Group)
ds <- DESeq(ds, test="Wald", sfType="poscount")
            </code></pre>
        </div>

        <div class="explanation">
            <h3>7. Extract and Process Results</h3>
            <p>We extract the results from DESeq2, separating the differentially expressed genes (DEGs) into upregulated and downregulated categories, and prepare the top genes for further analysis.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Extract results for top genes
r <- results(ds, contrast = c("Group", groups[1], groups[2]), alpha = 0.01, pAdjustMethod = "fdr")

# Separate downregulated and upregulated DEGs
downregulated <- r[r$log2FoldChange < 0 & r$padj < 0.01, ]
upregulated <- r[r$log2FoldChange > 0 & r$padj < 0.01, ]

# Take the top 10 genes for downregulated and upregulated
top_downregulated <- downregulated[order(downregulated$log2FoldChange)[1:10], ]
top_upregulated <- upregulated[order(upregulated$log2FoldChange, decreasing = TRUE)[1:10], ]

# Merge with gene annotations
top_downregulated <- merge(as.data.frame(top_downregulated), annot, by = 0, sort = FALSE)
top_upregulated <- merge(as.data.frame(top_upregulated), annot, by = 0, sort = FALSE)

# Round "padj" and "log2FoldChange" columns for readability
top_downregulated <- within(top_downregulated, {
  padj <- sprintf("%.4f", round(padj, 2))
  log2FoldChange <- sprintf("%.4f", round(log2FoldChange, 2))
})

top_upregulated <- within(top_upregulated, {
  padj <- sprintf("%.4f", round(padj, 2))
  log2FoldChange <- sprintf("%.4f", round(log2FoldChange, 2))
})

# Print the top_downregulated table using kable
kable(top_downregulated, format = "markdown")
kable(top_upregulated, format = "markdown")
            </code></pre>
        </div>

        <div class="explanation">
            <h3>8. General Data Visualization</h3>
            <p>We generate various plots to visualize the data and the results of the differential expression analysis.</p>

            <h4>8.1 Box Plot</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Box-and-whisker plot
dat <- log10(counts(ds, normalized = T) + 1)
ord <- order(gs)
palette(c("#1B9E77", "#7570B3"))
par(mar=c(7,4,2,1))
boxplot(dat[,ord], boxwex=0.6, notch=T, main="GSE157194", ylab="lg(norm.counts)", outline=F, las=2, col=gs[ord])
legend("topleft", groups, fill=palette(), bty="n")
            </code></pre>
        </div>

        <div class="explanation">
            <h4>8.2 Dispersion Estimates</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Dispersion estimates plot
plotDispEsts(ds, main="GSE157194 Dispersion Estimates")
            </code></pre>
        </div>

        <div class="explanation">
            <h4>8.3 UMAP Plot</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# UMAP plot
dat <- dat[!duplicated(dat), ]
par(mar=c(3,3,2,6), xpd=TRUE, cex.main=1.5)
ump <- umap(t(dat), n_neighbors = 15, random_state = 123)
plot(ump$layout, main="UMAP plot, nbrs=15", xlab="", ylab="", col=gs, pch=20, cex=1.5)
legend("topright", inset=c(-0.15,0), legend=groups, pch=20, col=1:length(groups), title="Group", pt.cex=1.5)
            </code></pre>
        </div>

        <div class="explanation">
            <h4>8.4 Histogram of P-values</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Histogram of adjusted p-values
hist(r$padj, breaks=seq(0, 1, length = 21), col = "grey", border = "white", 
     xlab = "", ylab = "", main = "GSE157194 Frequencies of padj-values")
            </code></pre>
        </div>

        <div class="explanation">
            <h4>8.5 Volcano Plot</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Volcano plot
old.pal <- palette(c("#00BFFF", "#FF3030"))
par(mar=c(4,4,2,1), cex.main=1.5)
plot(r$log2FoldChange, -log10(r$padj), main=paste(groups[1], "vs", groups[2]),
     xlab="log2FC", ylab="-log10(Padj)", pch=20, cex=0.5)
with(subset(r, padj<0.01 & abs(log2FoldChange) >= 1.5),
     points(log2FoldChange, -log10(padj), pch=20, col=(sign(log2FoldChange) + 3)/2, cex=1))
legend("bottomleft", title=paste("Padj<", 0.01, sep=""), legend=c("down", "up"), pch=20,col=1:2)
            </code></pre>
        </div>

        <div class="explanation">
            <h4>8.6 MA Plot</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# MA plot
par(mar=c(4,4,2,1), cex.main=1.5)
plot(log10(r$baseMean), r$log2FoldChange, main=paste(groups[1], "vs", groups[2]),
     xlab="log10(mean of normalized counts)", ylab="log2FoldChange", pch=20, cex=0.5)
with(subset(r, padj<0.01 & abs(log2FoldChange) >= 1.5),
     points(log10(baseMean), log2FoldChange, pch=20, col=(sign(log2FoldChange) + 3)/2, cex=1))
legend("bottomleft", title=paste("Padj<", 0.01, sep=""), legend=c("down", "up"), pch=20,col=1:2)
abline(h=0)
palette(old.pal)
            </code></pre>
        </div>

        <div class="explanation">
            <h3>9. Functional Annotation and Pathway Analysis</h3>
            <p>After identifying DEGs, we perform GO and KEGG pathway enrichment analyses to understand the biological significance of the results.</p>

            <h4>9.1 Gene Ontology (GO) Enrichment Analysis</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# GO enrichment analysis for upregulated and downregulated genes
up_genes <- top_upregulated$GeneID
down_genes <- top_downregulated$GeneID

# GO enrichment for upregulated genes
ego_up <- enrichGO(gene = up_genes, OrgDb = org.Hs.eg.db, keyType = "ENSEMBL",
                   ont = "BP", pAdjustMethod = "fdr", qvalueCutoff = 0.05)

# GO enrichment for downregulated genes
ego_down <- enrichGO(gene = down_genes, OrgDb = org.Hs.eg.db, keyType = "ENSEMBL",
                     ont = "BP", pAdjustMethod = "fdr", qvalueCutoff = 0.05)

# Plotting the top GO terms
barplot(ego_up, showCategory=10, title="Top GO terms for Upregulated Genes", drop=TRUE)
barplot(ego_down, showCategory=10, title="Top GO terms for Downregulated Genes", drop=TRUE)
            </code></pre>
        </div>

        <div class="explanation">
            <h4>9.2 KEGG Pathway Enrichment Analysis</h4>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# KEGG pathway enrichment analysis for upregulated and downregulated genes
kegg_up <- enrichKEGG(gene = up_genes, organism = "hsa", pAdjustMethod = "fdr", qvalueCutoff = 0.05)
kegg_down <- enrichKEGG(gene = down_genes, organism = "hsa", pAdjustMethod = "fdr", qvalueCutoff = 0.05)

# Plotting the top KEGG pathways
barplot(kegg_up, showCategory=10, title="Top KEGG Pathways for Upregulated Genes")
barplot(kegg_down, showCategory=10, title="Top KEGG Pathways for Downregulated Genes")
            </code></pre>
        </div>

        <div class="explanation">
            <h3>10. Venn Diagram for Gene Sets</h3>
            <p>We visualize the overlap between different gene sets (total, upregulated, downregulated) using a Venn diagram.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Venn diagram for gene sets
total_genes <- rownames(tbl)
upregulated_genes <- rownames(top_upregulated)
downregulated_genes <- rownames(top_downregulated)

venn_data <- list(
  Total = total_genes,
  Upregulated = upregulated_genes,
  Downregulated = downregulated_genes
)

venn_plot <- venn.diagram(
  x = venn_data,
  category.names = c("Total", "Upregulated", "Downregulated"),
  filename = NULL,
  margin = 0,
  cex.prop = 0.8,
  offset.prop = 0.2
)

grid.draw(venn_plot)
            </code></pre>
        </div>

        <div class="explanation">
            <h3>11. Extract Top 20 Genes and Print Results</h3>
            <p>Finally, we extract the top 20 differentially expressed genes from both categories and print the results.</p>
        </div>

        <div class="code-block">
            <pre><code class="language-r">
# Extract results for top genes table (rounded)
r <- results(ds, contrast = c("Group", groups[1], groups[2]), alpha = 0.01, pAdjustMethod = "fdr")

# Separate downregulated and upregulated DEGs
downregulated <- r[r$log2FoldChange < 0 & r$padj < 0.01, ]
upregulated <- r[r$log2FoldChange > 0 & r$padj < 0.01, ]

# Take the top 20 genes for downregulated and upregulated
top_downregulated <- downregulated[order(downregulated$log2FoldChange)[1:20], ]
top_upregulated <- upregulated[order(upregulated$log2FoldChange, decreasing = TRUE)[1:20], ]

# Merge with gene annotations
top_downregulated <- merge(as.data.frame(top_downregulated), annot, by = 0, sort = FALSE)
top_upregulated <- merge(as.data.frame(top_upregulated), annot, by = 0, sort = FALSE)

# Round "padj" and "log2FoldChange" columns
top_downregulated <- within(top_downregulated, {
  padj <- sprintf("%.4f", round(padj, 4))
  log2FoldChange <- sprintf("%.4f", round(log2FoldChange, 4))
 })

top_upregulated <- within(top_upregulated, {
  padj <- sprintf("%.4f", round(padj, 4))
  log2FoldChange <- sprintf("%.4f", round(log2FoldChange, 4))
})

# Print the top_downregulated table using kable
kable(top_downregulated, format = "markdown") 
kable(top_upregulated, format = "markdown")
            </code></pre>
        </div>

        <div class="explanation">
            <h3>Conclusion</h3>
            <p>This complete pipeline guides you through performing differential gene expression analysis on the GSE157194 dataset using DESeq2. The analysis identifies significant gene expression changes between lesional and non-lesional skin samples from Atopic Dermatitis patients, and includes essential data visualizations and enrichment analyses to interpret the results biologically.</p>
        </div>
    </div>

    <!-- Prism.js library for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
	  
    <!-- Load R language support for Prism -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-r.min.js"></script>


	  
/*  =============================================================================================================   */ 
/*  ====================== To highlight the figure or caption when a user clicks on the link:  ================   */ 
	    /*  ====================== Step 2: Add JavaScript to apply the class  ================   */ 
	<script>
	  function highlightFigure(figureId) {
	    var figureCaption = document.getElementById("figure-caption-" + figureId);
	    figureCaption.classList.add('highlight');
	    setTimeout(function() {
	      figureCaption.classList.remove('highlight');
	    }, 2000);  // Highlight lasts for 5 seconds
	  }
	</script>  
/*  =============================================================================================================   */ 


 
	  
</body>
</html> 
